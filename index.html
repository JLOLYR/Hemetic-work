<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adonai: Sendero Herm√©tico</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #080b10;
            --bg-card: rgba(22, 33, 49, 0.95);
            --bg-header: rgba(11, 16, 22, 0.98);
            --accent-gold: #d4af37;
            --accent-gold-light: #f3e5ab;
            --accent-teal: #1c5d66;
            --accent-teal-bright: #4db6ac;
            --text-main: #e0e0e0;
            --text-muted: #8c9bb0;
            --success: #2e7d32;
            --locked: #444;
            --border-color: rgba(212, 175, 55, 0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 5% 10%, rgba(28, 93, 102, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 95% 90%, rgba(212, 175, 55, 0.08) 0%, transparent 40%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            padding: 20px 15px;
            text-align: center;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }

        h1 {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            margin: 0;
            font-size: 1.5rem;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .subtitle {
            font-size: 0.7rem;
            color: var(--accent-teal-bright);
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .container {
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-out;
        }

        /* --- TARJETAS DE GRADOS --- */
        .grade-wrapper { margin-bottom: 25px; position: relative; }
        
        .grade-wrapper:not(:last-child)::after {
            content: ''; position: absolute; left: 24px; bottom: -25px; height: 25px; width: 1px;
            background: linear-gradient(to bottom, var(--accent-gold), rgba(212, 175, 55, 0.05));
            z-index: 0; opacity: 0.4;
        }

        .grade-header {
            background: linear-gradient(145deg, #1f2b3e, #111821);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }

        .grade-header:active { transform: scale(0.99); }
        
        .grade-header.locked {
            background: #121212;
            border-color: #2a2a2a;
            opacity: 0.7;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .grade-header.completed {
            border-left: 3px solid var(--success);
            background: linear-gradient(145deg, #1a241c, #0f1c13);
        }

        .grade-title { font-family: 'Cinzel', serif; font-weight: 700; color: var(--accent-gold-light); font-size: 1.1rem; }
        .grade-info { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; text-transform: uppercase; letter-spacing: 1px; }

        /* --- LISTA DE EJERCICIOS --- */
        .exercises-list {
            display: none;
            padding: 15px 0 0 10px;
            margin-left: 15px;
            border-left: 1px solid rgba(212, 175, 55, 0.1);
        }
        .exercises-list.open { display: block; animation: slideDown 0.3s ease-out; }

        .exercise-card {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.03);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .ex-tag {
            position: absolute; top: 0; right: 0;
            color: #111; font-size: 0.6rem; padding: 2px 8px;
            border-bottom-left-radius: 6px; font-weight: bold; text-transform: uppercase;
        }
        .ex-tag.mental { background: #b39ddb; }
        .ex-tag.astral { background: #ef9a9a; }
        .ex-tag.fisico { background: #a5d6a7; }

        .ex-title { font-weight: bold; font-size: 0.95rem; color: #fff; padding-right: 60px; margin-bottom: 15px; }

        /* PROGRESO */
        .progress-container { margin-bottom: 12px; }
        .progress-info { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px; }
        .progress-track { background: #0f151c; height: 6px; border-radius: 3px; overflow: hidden; border: 1px solid #333; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-teal), var(--accent-gold)); transition: width 0.4s ease; }

        /* BOTONES */
        .actions { display: flex; gap: 8px; }
        .btn {
            flex: 1; padding: 10px; border: none; border-radius: 4px;
            font-family: 'Lato', sans-serif; font-weight: bold; font-size: 0.85rem;
            cursor: pointer; transition: transform 0.1s;
            display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn:active { transform: translateY(2px); }
        .btn-train { background: var(--accent-gold); color: #0a0a0a; box-shadow: 0 0 10px rgba(212, 175, 55, 0.15); }
        .btn-train:disabled { background: var(--success); color: white; cursor: default; box-shadow: none; opacity: 0.9; }
        .btn-theory { background: transparent; border: 1px solid var(--accent-teal); color: var(--accent-teal-bright); }

        /* --- HERRAMIENTAS --- */
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .tool-item {
            background: var(--bg-card); padding: 20px; border-radius: 8px; text-align: center;
            border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.3s;
        }
        .tool-item:hover { border-color: var(--accent-gold); transform: translateY(-2px); }
        .tool-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .tool-text { font-size: 0.9rem; color: #ddd; }

        /* --- NAVEGACION INFERIOR --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(8, 11, 16, 0.98); backdrop-filter: blur(15px);
            display: flex; justify-content: space-around; padding: 10px 0;
            border-top: 1px solid var(--border-color); z-index: 100;
        }
        .nav-btn { background: none; border: none; color: #555; font-size: 0.65rem; display: flex; flex-direction: column; align-items: center; padding: 5px; cursor: pointer; transition: 0.2s; }
        .nav-btn.active { color: var(--accent-gold); transform: scale(1.1); }
        .nav-btn svg { width: 22px; height: 22px; margin-bottom: 4px; fill: currentColor; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 2000; overflow-y: auto; animation: fadeIn 0.3s; }
        .modal-content {
            background: #11161f; margin: 5% auto; width: 90%; max-width: 650px; padding: 25px;
            border-radius: 8px; border: 1px solid var(--accent-gold); color: #ccc;
            position: relative; box-shadow: 0 0 40px rgba(212, 175, 55, 0.1);
        }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 28px; color: var(--accent-gold); cursor: pointer; line-height: 1; }
        .modal-body { margin-top: 10px; line-height: 1.7; font-size: 0.95rem; }
        .modal-body h3 { color: var(--accent-gold); font-family: 'Cinzel', serif; border-bottom: 1px solid #333; padding-bottom: 8px; margin-top: 25px; font-size: 1.2rem; }
        .modal-body h3:first-child { margin-top: 0; }
        .modal-body strong { color: #fff; }
        .modal-body ul, .modal-body ol { padding-left: 20px; color: #bbb; }
        .modal-body li { margin-bottom: 8px; }
        .warning-box { background: rgba(198, 40, 40, 0.1); border-left: 3px solid #c62828; padding: 10px; margin: 15px 0; font-size: 0.9rem; color: #ffcdd2; }

        /* Tattwas */
        .tattwa-box { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px;}
        .tattwa-wrapper { text-align: center; display: flex; flex-direction: column; align-items: center; }
        .tattwa-fire { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 50px solid #e53935; margin: 0 auto; filter: drop-shadow(0 0 5px red);}
        .tattwa-water { width: 50px; height: 25px; background: silver; border-radius: 0 0 50px 50px; margin: 15px auto 0; border: 2px solid #eee; filter: drop-shadow(0 0 5px silver); }
        .tattwa-air { width: 50px; height: 50px; background: #2196f3; border-radius: 50%; margin: 0 auto; filter: drop-shadow(0 0 5px blue); }
        .tattwa-earth { width: 50px; height: 50px; background: #fdd835; margin: 0 auto; border: 1px solid #c6a700; filter: drop-shadow(0 0 5px yellow);}
        .tattwa-akasha { width: 40px; height: 55px; background: #000; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; margin: 0 auto; border: 1px solid #444; filter: drop-shadow(0 0 5px white);}

        @keyframes slideDown { from {opacity: 0; transform: translateY(-10px);} to {opacity: 1; transform: translateY(0);} }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

    </style>
</head>
<body>

<header>
    <h1>Adonai</h1>
    <div class="subtitle">Sistema de Iniciaci√≥n Herm√©tica</div>
</header>

<div id="main-view" class="container"></div>

<nav class="nav-bar">
    <button class="nav-btn active" onclick="renderView('training')">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
        Pr√°ctica
    </button>
    <button class="nav-btn" onclick="renderView('tools')">
        <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
        Herramientas
    </button>
    <button class="nav-btn" onclick="renderView('library')">
        <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"/></svg>
        Biblioteca
    </button>
    <button class="nav-btn" onclick="resetProgressConfirm()">
        <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
        Reset
    </button>
</nav>

<!-- Modal -->
<div id="appModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div id="modal-body" class="modal-body"></div>
    </div>
</div>

<script>
    /* =========================================
       BASE DE DATOS DE CONTENIDO TE√ìRICO DETALLADO PARA LOS 10 GRADOS
       ========================================= */
    const libraryData = {
        // --- GRADO I ---
        'g1_m_obs': `
            <h3>1. Control del Pensamiento (Observaci√≥n)</h3>
            <p>Este es el ejercicio fundamental. Debes aprender a ser un espectador de tu propia mente.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en una posici√≥n c√≥moda (Asana). Relaje todo el cuerpo. Cierre los ojos.</li>
                <li>Convi√©rtase en un <strong>observador silencioso</strong> de su propia mente.</li>
                <li>No intente detener los pensamientos ni forzar nada. No los juzgue, no se enoje si son triviales o "malos".</li>
                <li>D√©jelos pasar como veh√≠culos en una carretera o como nubes en el cielo.</li>
            </ol>
            <p><b>Meta:</b> Debe lograr esto durante <strong>10 minutos</strong> completos sin perder la postura de observador y sin ser arrastrado por una cadena de pensamientos.</p>
        `,
        'g1_m_disc': `
            <h3>2. Disciplina del Pensamiento (Unidireccional)</h3>
            <p>Una vez que puede observar sus pensamientos, debe aprender a sostener uno solo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Elija un pensamiento simple o imagen (ej. una flor, una vela, la palabra "Luz").</li>
                <li>Mantenga ese pensamiento en el centro de su mente con toda su fuerza y claridad. Visual√≠celo y conc√©ntrese solo en √©l.</li>
                <li>Si otro pensamiento intruso intenta entrar, rech√°celo con firmeza pero sin esfuerzo excesivo, y vuelva inmediatamente a su objeto elegido.</li>
            </ol>
            <p><b>Meta:</b> Mantener la imagen o idea durante <strong>10 minutos</strong> sin una sola interrupci√≥n. Con la pr√°ctica, la imagen se volver√° m√°s n√≠tida.</p>
        `,
        'g1_m_vaci': `
            <h3>3. Vac√≠o Mental (Silencio)</h3>
            <p>Este es el fundamento de toda operaci√≥n m√°gica futura y la clave para el Akasha.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Cierre los ojos. Relaje el cuerpo por completo.</li>
                <li>Rechace en√©rgicamente, pero sin lucha, cualquier pensamiento o imagen que intente aparecer.</li>
                <li>Cree un estado de vac√≠o absoluto en su mente. No debe haber im√°genes, ni palabras, ni sonidos internos. Solo el silencio total.</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> Si se siente cansado o somnoliento, detenga el ejercicio. NUNCA se duerma durante este ejercicio, ya que podr√≠a llevar a un desequilibrio.</div>
            <p><b>Meta:</b> Lograr <strong>10 minutos</strong> de vac√≠o mental perfecto sin quedarse dormido y sin perder la conciencia. Esto requiere mucha pr√°ctica y perseverancia.</p>
        `,
        'g1_a_magic': `
            <h3>El Espejo M√°gico del Alma (Introspecci√≥n)</h3>
            <p>El equilibrio elemental del alma es la base del car√°cter y el poder m√°gico. Un mago desequilibrado se destruir√° a s√≠ mismo.</p>
            <p><b>Instrucci√≥n (Introspecci√≥n Rigurosa):</b></p>
            <ol>
                <li>Tome un cuaderno privado (Diario M√°gico). Este ser√° SUYO y NO debe ser visto por nadie.</li>
                <li>Haga una lista exhaustiva de <strong>todos sus defectos</strong>, debilidades, vicios y malos h√°bitos. Sea brutalmente honesto. (Este es su "Espejo Negro del Alma").</li>
                <li>Haga otra lista con <strong>todas sus virtudes</strong> y fortalezas. (Este es su "Espejo Blanco del Alma").</li>
                <li><b>Clasificaci√≥n Elemental:</b> Asigne cada defecto y virtud a un elemento predominante. Bardon lo resume as√≠:
                    <ul>
                        <li>üî• <b>Fuego (Voluntad/Pasi√≥n):</b> Ira, odio, celos, impulsividad, agresividad, entusiasmo, determinaci√≥n, audacia.</li>
                        <li>üí® <b>Aire (Intelecto/Claridad):</b> Frivolidad, presunci√≥n, chisme, inestabilidad, curiosidad, optimismo, bondad, alegr√≠a.</li>
                        <li>üíß <b>Agua (Sentimiento/Vida):</b> Indiferencia, frialdad, timidez, negligencia, compasi√≥n, serenidad, perd√≥n, ternura.</li>
                        <li>üåç <b>Tierra (Conciencia/Prudencia):</b> Pereza, melancol√≠a, lentitud, pesadez, falta de conciencia, atenci√≥n, perseverancia, sobriedad.</li>
                    </ul>
                </li>
            </ol>
            <p><b>Meta:</b> Tener un "Espejo del Alma" lo m√°s completo posible (al menos 100 elementos) con defectos y virtudes clasificados por elementos. Este proceso puede tomar varias semanas.</p>
        `,
        'g1_p_skin': `
            <h3>Higiene Energ√©tica Diaria</h3>
            <p>El cuerpo debe estar limpio y preparado para manejar altas corrientes de energ√≠a. La piel es un "segundo pulm√≥n y ri√±√≥n".</p>
            <p><b>Instrucci√≥n (Ma√±ana):</b></p>
            <ol>
                <li><b>Cepillado en seco:</b> Use un cepillo de cerdas naturales o una toalla √°spera. Cepille todo el cuerpo en seco hasta que la piel se ponga rosada. Esto abre los poros.</li>
                <li><b>Lavado con agua fr√≠a:</b> L√°vese la parte superior del cuerpo (o d√∫chese completo) con agua fr√≠a.</li>
                <li><b>Visualizaci√≥n:</b> Mientras se lava, imagine firmemente que el agua no solo limpia el sudor, sino que arrastra y elimina todas las impurezas energ√©ticas, enfermedades, des√°nimo y cargas negativas de su aura.</li>
            </ol>
        `,
        'g1_p_breath': `
            <h3>Respiraci√≥n Consciente de Aire</h3>
            <p>La respiraci√≥n es el puente entre lo material y lo Ak√°shico. El aire transporta el principio Akasha y la energ√≠a vital.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en Asana. Respire por la nariz lenta y uniformemente.</li>
                <li><b>Imaginaci√≥n:</b> Al inhalar, imagine que el aire est√° cargado de un deseo espec√≠fico o cualidad (ej. "Salud perfecta", "Paz interior", "√âxito en mi misi√≥n").</li>
                <li>Sienta que esa idea, coloreada por el elemento aire (azul), entra en su sangre a trav√©s de los pulmones y se distribuye por todo el cuerpo, impregnando cada c√©lula.</li>
                <li>Al exhalar, expulse solo el aire "vac√≠o", pero <strong>retenga y fije firmemente la idea/energ√≠a</strong> dentro de usted.</li>
            </ol>
            <p><b>Progresi√≥n:</b> Comience con <strong>7 respiraciones</strong> por la ma√±ana y 7 por la noche. Aumente 1 respiraci√≥n por d√≠a. La meta es alcanzar un m√≠nimo de <strong>20-30 respiraciones</strong> sin cansar los pulmones. No exceda 10-15 minutos por sesi√≥n.</p>
            <div class="warning-box"><b>Advertencia:</b> NUNCA respire conscientemente sin una idea o cualidad clara en mente. Siempre debe ser un prop√≥sito espec√≠fico.</div>
        `,
        'g1_p_euc': `
            <h3>Magia del Agua y la Comida (Eucarist√≠a)</h3>
            <p>Todo lo que entra en el cuerpo puede ser un veh√≠culo m√°gico para sus deseos. Es una forma de "comuni√≥n sagrada".</p>
            <p><b>Instrucci√≥n (Comida):</b></p>
            <ol>
                <li>Si√©ntese ante su comida. Conc√©ntrese intensamente en que la comida contiene un deseo espec√≠fico (ej. "Poder", "Salud", "Vitalidad").</li>
                <li>Imagine la comida irradiando esa cualidad. Bardon la compara con la Eucarist√≠a, es un acto sagrado.</li>
                <li>Coma lentamente, mastique completamente, asimilando esa energ√≠a con cada bocado.</li>
                <li>NO hable ni lea mientras come; su mente debe estar fija en su deseo.</li>
            </ol>
            <p><b>Instrucci√≥n (Agua M√°gica):</b></p>
            <ol>
                <li>Tome un vaso de agua pura con la mano izquierda.</li>
                <li>Conc√©ntrese en el agua, proyectando su deseo en ella hasta que sienta que el agua "es" el deseo (ej. "Curaci√≥n universal", "Claridad mental").</li>
                <li>Beba el agua a sorbos peque√±os, asimilando la energ√≠a impregnada.</li>
                <li>Tambi√©n puede usar esta t√©cnica con agua para lavarse, imaginando la limpieza de su aura.</li>
            </ol>
        `,

        // --- GRADO II ---
        'g2_mental': `
            <h3>Autosugesti√≥n</h3>
            <p>El subconsciente es m√°s receptivo en los momentos de transici√≥n entre vigilia y sue√±o. Esta es la base de la programaci√≥n mental.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Prepare una frase corta, clara y positiva en tiempo presente (ej. "Yo estoy sano", "Mi memoria es perfecta", "Mi voluntad es inquebrantable").</li>
                <li>Justo antes de dormir (cuando la somnolencia es m√°xima) y nuevamente inmediatamente al despertar (antes de que la mente consciente tome el control), repita esta frase mentalmente.</li>
                <li><b>El Collar de Cuentas:</b> Use un collar de cuentas (30-40 cuentas) o una cuerda con nudos para contar 40 repeticiones. Esto evita que su mente consciente se distraiga contando n√∫meros.</li>
            </ol>
            <p><b>Meta:</b> Realizar 40 repeticiones de la autosugesti√≥n dos veces al d√≠a hasta que el deseo se manifieste, o hasta que est√© satisfecho con el resultado. NO pase a otra autosugesti√≥n hasta completar la anterior.</p>
        `,
        'g2_sensory': `
            <h3>Concentraci√≥n Sensorial (Los 5 Sentidos)</h3>
            <p>El mago debe aprender a usar sus sentidos mentales con la misma claridad e intensidad que los f√≠sicos.</p>
            <p><b>Instrucci√≥n:</b></p>
            <p>Dedique tiempo a cada sentido, comenzando con 5 minutos y aumentando gradualmente:</p>
            <ol>
                <li><b>Visual:</b> Cierre los ojos. Visualice un objeto simple (ej. un tenedor) con todos sus detalles, colores y forma. Mantenga la imagen fija y n√≠tida. Luego intente hacerlo con los ojos abiertos, proyectando la imagen en el aire.</li>
                <li><b>Auditiva:</b> Cierre los ojos. Escuche mentalmente un sonido espec√≠fico (ej. el tic-tac de un reloj). Conc√©ntrese solo en el sonido, sin im√°genes. Progrese a sonidos m√°s complejos (m√∫sica).</li>
                <li><b>T√°ctil:</b> Cierre los ojos. Sienta una sensaci√≥n f√≠sica (ej. fr√≠o intenso, calor, peso, ligereza) sin causa externa. Mantenga la sensaci√≥n firme.</li>
                <li><b>Olfativa:</b> Cierre los ojos. Huela mentalmente un aroma (ej. una rosa, caf√©) sin la sustancia f√≠sica.</li>
                <li><b>Gustativa:</b> Cierre los ojos. Saboree mentalmente un gusto (ej. az√∫car, lim√≥n) sin comer nada.</li>
            </ol>
            <p><b>Meta:</b> Lograr 5 minutos de concentraci√≥n perfecta en cada sentido. Luego intente combinar 2 o 3 sentidos simult√°neamente (ej. ver y o√≠r la campana).</p>
        `,
        'g2_astral': `
            <h3>Equilibrio M√°gico (Transmutaci√≥n del Car√°cter)</h3>
            <p>Este es el trabajo de la "Piedra Filosofal" en el alma, crucial para la evoluci√≥n m√°gica. Sin equilibrio, el mago se destruye a s√≠ mismo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Tome su lista de defectos del Grado 1 (Espejo Negro).</li>
                <li>Seleccione los defectos m√°s graves y luego los medianos y peque√±os.</li>
                <li><b>M√©todo 1 (Combate):</b> Cada vez que surja el defecto, contrarr√©strelo conscientemente con la virtud opuesta (ej. si siente ira, evoque amor).</li>
                <li><b>M√©todo 2 (Autosugesti√≥n):</b> Use el ejercicio de autosugesti√≥n para eliminar un defecto o fomentar una virtud.</li>
                <li><b>M√©todo 3 (Observaci√≥n):</b> Observe el origen del impulso de la pasi√≥n y c√≥rtelo de ra√≠z con la voluntad.</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> NUNCA intente dominar los elementos sin antes haber logrado un equilibrio considerable de su car√°cter. El elemento dominante lo destruir√°.</div>
            <p><b>Meta:</b> Lograr un equilibrio notable en su temperamento y eliminar los defectos m√°s evidentes.</p>
        `,
        'g2_physical': `
            <h3>Respiraci√≥n por los Poros</h3>
            <p>El cuerpo puede respirar energ√≠a vital por cada c√©lula, no solo los pulmones. La piel es un "segundo pulm√≥n y ri√±√≥n" para el Akasha.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en Asana. Relaje toda la musculatura del cuerpo.</li>
                <li>Imagine que su piel tiene millones de peque√±os pulmones.</li>
                <li>Al inhalar, sienta que el aire vital (cargado de luz o una cualidad espec√≠fica) entra por cada poro de su cuerpo, llen√°ndolo hasta los huesos.</li>
                <li>Sienta la presi√≥n de la energ√≠a vital dentro de usted, como una esponja que absorbe agua.</li>
                <li>Al exhalar, imagine que expulsa impurezas, aire viciado y cualquier sensaci√≥n negativa por cada poro hacia afuera.</li>
            </ol>
            <p><b>Meta:</b> Lograr una respiraci√≥n consciente completa por los poros de todo el cuerpo.</p>
        `,
        'g2_body': `
            <h3>Dominio del Cuerpo (Inmovilidad)</h3>
            <p>Para controlar fuerzas externas, primero debe controlar su propio veh√≠culo f√≠sico.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en una posici√≥n c√≥moda (Asana), con la columna recta, pies juntos y manos sobre los muslos.</li>
                <li>Permanezca absolutamente inm√≥vil. No mueva ni un dedo, no parpadee excesivamente, no se rasque. Ignore cualquier picaz√≥n, hormigueo o impulso.</li>
                <li>Si sus rodillas se separan, puede atarlas con un pa√±uelo.</li>
            </ol>
            <p><b>Meta:</b> Lograr <strong>30 minutos</strong> de inmovilidad perfecta sin tensi√≥n ni perturbaciones nerviosas. Esto fortalecer√° enormemente su fuerza de voluntad.</p>
        `,

        // --- GRADO III ---
        'g3_mental': `
            <h3>Concentraci√≥n Multisensorial y Proyecci√≥n Externa de Im√°genes</h3>
            <p><b>Visualizaci√≥n Multisensorial:</b> Imagine un objeto. M√≠relo (visi√≥n), escuche su sonido (audici√≥n) y sienta su tacto (sensaci√≥n) simult√°neamente. Progrese combinando los 5 sentidos.</p>
            <p><b>Proyecci√≥n Externa:</b></p>
            <ol>
                <li>Visualice un objeto con los ojos cerrados, tan n√≠tido como real.</li>
                <li>Luego, abra los ojos y proyecte esa imagen fuera de su cabeza, haci√©ndola flotar en el aire ante usted.</li>
                <li>La imagen debe parecer tan real y tangible como un objeto f√≠sico.</li>
                <li>Aprenda a desvanecer la imagen a voluntad.</li>
            </ol>
            <p><b>Meta:</b> Mantener la imagen externa n√≠tida y tangible por 5 minutos. Esta es la base de la materializaci√≥n.</p>
        `,
        'g3_astral': `
            <h3>Respiraci√≥n de los Elementos</h3>
            <p>Aprender a cargar el cuerpo astral con los elementos universales. Use la respiraci√≥n por los poros como en el Grado II.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>üî• <b>Fuego (Rojo):</b> Inhale el elemento Fuego (calor y expansi√≥n) en todo su cuerpo. Sienta el calor f√≠sico y la presi√≥n √≠gnea.</li>
                <li>üí® <b>Aire (Azul):</b> Inhale el elemento Aire (ligereza y flotabilidad). Sienta que pierde peso y se vuelve como un globo.</li>
                <li>üíß <b>Agua (Plata):</b> Inhale el elemento Agua (fr√≠o y contracci√≥n, magn√©tico). Sienta fr√≠o glacial.</li>
                <li>üåç <b>Tierra (Amarillo):</b> Inhale el elemento Tierra (peso y gravedad). Sienta pesadez de plomo y solidez.</li>
            </ul>
            <div class="warning-box"><b>¬°ADVERTENCIA CR√çTICA!</b> Al terminar CADA ejercicio elemental, siempre debe EXHALAR el elemento completamente, imaginando que regresa al universo. No retenga un elemento, ya que causar√° desequilibrios, enfermedades y obsesiones.</div>
            <p><b>Meta:</b> Realizar 7 inhalaciones y exhalaciones por elemento. Repetir diariamente hasta sentir el elemento f√≠sicamente.</p>
        `,
        'g3_physical': `
            <h3>Acumulaci√≥n de Energ√≠a Vital (Biomagnetismo)</h3>
            <p>Aprender a acumular y proyectar la energ√≠a vital para curar o influenciar.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Respire por los poros inhalando energ√≠a vital del universo.</li>
                <li>NO exhale la energ√≠a. Ret√©ngala en el cuerpo. Exhale solo el aire viciado.</li>
                <li>Con cada respiraci√≥n, la energ√≠a se condensa m√°s, como un vapor comprimido. Sienta la presi√≥n y el calor dentro de usted.</li>
                <li>Cuando est√© lleno a reventar (sentir√° irradiaci√≥n a 1 metro), proyecte esa energ√≠a a trav√©s de sus manos para curar a otros, o devu√©lvala al universo explosivamente para disolver la tensi√≥n.</li>
            </ol>
        `,

        // --- GRADO IV ---
        'g4_mental': `
            <h3>Transposici√≥n de la Conciencia (Mental)</h3>
            <p>El objetivo es romper la barrera del "Yo" y expandir la conciencia m√°s all√° del cuerpo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Elija un objeto (ej. una piedra, un l√°piz). Si√©ntese frente a √©l.</li>
                <li>Transfiera su conciencia al centro del objeto. Olvide su propio cuerpo y si√©ntase como el objeto (su forma, peso, textura).</li>
                <li>Progrese con plantas (sienta el crecimiento), luego animales (sienta sus instintos) y finalmente, con mucha cautela, con seres humanos (sienta sus pensamientos y emociones).</li>
            </ol>
            <p><b>Meta:</b> Lograr 5 minutos de transposici√≥n perfecta a cada tipo de objeto/ser. Luego intente hacerlo con los ojos abiertos.</p>
        `,
        'g4_astral': `
            <h3>Represamiento de los Elementos en Partes del Cuerpo (Anatom√≠a Oculta)</h3>
            <p>Cargar regiones espec√≠ficas del cuerpo con los elementos para fortalecer el cuerpo astral y equilibrar las funciones. Esto se basa en la anatom√≠a oculta de Bardon.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>üî• <b>Fuego (Cabeza):</b> Respire Fuego en su cabeza para fortalecer la voluntad e intelecto.</li>
                <li>üí® <b>Aire (Pecho):</b> Respire Aire en su pecho para equilibrar los sentimientos y la vida.</li>
                <li>üíß <b>Agua (Abdomen):</b> Respire Agua en su abdomen para dominar las pasiones y el magnetismo.</li>
                <li>üåç <b>Tierra (Piernas/Pies):</b> Respire Tierra en sus piernas y pies para fortalecer la conciencia f√≠sica y el enraizamiento.</li>
            </ul>
        `,
        'g4_physical': `
            <h3>Creaci√≥n de Rituales (Gesticulaci√≥n)</h3>
            <p>El mago no depende de rituales ajenos; crea los suyos propios. Los gestos son anclas poderosas para la voluntad.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Elija una intenci√≥n espec√≠fica (ej. protecci√≥n, evocar simpat√≠a, calmar la mente).</li>
                <li>Invente un gesto simple con las manos o dedos (ej. un mudra) que simbolice esa intenci√≥n.</li>
                <li>Cargue ese gesto con su voluntad y el poder de su imaginaci√≥n repetidamente.</li>
                <li>Con el tiempo, solo hacer el gesto liberar√° la energ√≠a o el efecto deseado autom√°ticamente (como un "gatillo" m√°gico).</li>
            </ol>
            <p><b>Meta:</b> Desarrollar al menos 3-5 rituales personales efectivos.</p>
        `,

        // --- GRADO V ---
        'g5_m_space': `
            <h3>Magia del Espacio (Profundidad del Punto)</h3>
            <p>Este es el secreto de la cuarta dimensi√≥n y el principio del Akasha.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en Asana. Cierre los ojos.</li>
                <li>Imagine el universo entero como un espacio infinito sin l√≠mites.</li>
                <li>Usted no tiene cuerpo; es solo un punto de conciencia en el centro de ese espacio.</li>
                <li>No hay arriba, abajo, ni lados. Solo profundidad infinita. Esta es la experiencia del Akasha.</li>
            </ol>
            <p><b>Meta:</b> Mantener esta conciencia del "punto de profundidad" por 10 minutos. Es la base para el viaje mental.</p>
        `,
        'g5_a_proj': `
            <h3>Proyecci√≥n Exterior de Elementos (Condensaci√≥n Directa)</h3>
            <p>Aprender a condensar elementos directamente del universo sin que pasen por el cuerpo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Elija un elemento (Fuego, Aire, Agua, Tierra) y un espacio (su habitaci√≥n).</li>
                <li>Imagine que extrae el elemento directamente del universo y llena la habitaci√≥n con √©l.</li>
                <li>Haga que la habitaci√≥n se sienta f√≠sicamente con la cualidad del elemento (ej. caliente para Fuego, pesada para Tierra).</li>
                <li>No se canse. Al final, disuelva el elemento de nuevo en el universo.</li>
            </ol>
            <p><b>Meta:</b> Crear una atm√≥sfera elemental perceptible f√≠sicamente en una habitaci√≥n.</p>
        `,
        'g5_p_comm': `
            <h3>Comunicaci√≥n Pasiva (P√©ndulo y Mano)</h3>
            <p>Preparaci√≥n para contactar con su √Ångel Guardi√°n o inteligencias superiores.</p>
            <p><b>Pr√°ctica:</b></p>
            <ol>
                <li><b>Levitaci√≥n de la Mano:</b> Si√©ntese, ponga su mano en la mesa. Des√©e que su mano se levante por s√≠ sola, por la fuerza de su esp√≠ritu, sin usar m√∫sculos.</li>
                <li><b>P√©ndulo Sid√©rico:</b> Use un p√©ndulo (anillo en un hilo) sobre un alfabeto dibujado. Pida a su Gu√≠a Espiritual que mueva el p√©ndulo para respuestas. Primero, pregunte "S√≠" (3 toques), "No" (2 toques).</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> No use esto por simple curiosidad, solo por motivos nobles. No crea todo lo que se le dice sin verificaci√≥n.</div>
        `,

        // --- GRADO VI ---
        'g6_m_spirit': `
            <h3>Meditaci√≥n en el Propio Esp√≠ritu</h3>
            <p>Desarrollar la conciencia del esp√≠ritu como una entidad inmortal e independiente.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Medite profundamente en su "Yo" espiritual. Diferencie claramente entre:
                    <ul>
                        <li><b>Cuerpo F√≠sico:</b> El veh√≠culo.</li>
                        <li><b>Cuerpo Astral (Alma):</b> El asiento de emociones.</li>
                        <li><b>Esp√≠ritu (Mental/Yo):</b> La chispa divina, su verdadera esencia inmortal.</li>
                    </ul>
                </li>
                <li>Sienta que su esp√≠ritu impregna y mueve tanto su cuerpo astral como el f√≠sico.</li>
                <li>Aprenda a actuar y sentir plenamente como Esp√≠ritu.</li>
            </ol>
        `,
        'g6_a_akasha': `
            <h3>Inducci√≥n Consciente del Estado de Trance Ak√°shico</h3>
            <p>Contacto directo con el Akasha, la fuente original de toda existencia.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en Asana. Cierre los ojos.</li>
                <li>Inspire un flujo de Akasha (sustancia et√©rica violeta oscuro/negra brillante) por los pulmones y poros, llenando todo su cuerpo.</li>
                <li>Sienta el poder y el dominio sobre los cuatro elementos que el Akasha le confiere.</li>
                <li>Al exhalar, <strong>mantenga el Akasha dentro de usted</strong>. A diferencia de los elementos, el Akasha NO se exhala.</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> Este es un paso muy poderoso. Aseg√∫rese de un car√°cter noble antes de iniciar esta pr√°ctica.</div>
        `,
        'g6_p_elem': `
            <h3>Generaci√≥n o Cr√≠a de Elementales</h3>
            <p>Creaci√≥n de servidores de energ√≠a con una forma, nombre, tarea y tiempo de vida espec√≠ficos.</p>
            <p><b>Pasos:</b></p>
            <ol>
                <li><b>Forma:</b> Visualice la forma deseada (ej. bola de luz, figura humana, animal).</li>
                <li><b>Nombre:</b> Dele un nombre √∫nico y secreto (ej. "Lucis").</li>
                <li><b>Tarea:</b> Asigne una tarea espec√≠fica y √©tica (ej. proteger su casa, fortalecer su memoria).</li>
                <li><b>Tiempo de Vida:</b> Determine su duraci√≥n (ej. "hasta que la tarea se cumpla", "1 a√±o").</li>
                <li><b>Carga:</b> Proyecte parte de su propia energ√≠a vital o elemental en la forma.</li>
                <li><b>Env√≠o:</b> Rompa el "cord√≥n" mental que lo une a √©l. Env√≠elo a su misi√≥n.</li>
                <li><b>Reabsorci√≥n/Disoluci√≥n:</b> Al terminar la tarea o el tiempo, reabsorba la energ√≠a y disuelva la forma. NUNCA lo deje vagar sin prop√≥sito.</li>
            </ol>
        `,

        // --- GRADO VII ---
        'g7_m_spirit': `
            <h3>An√°lisis del Esp√≠ritu (II)</h3>
            <p>Contin√∫e el auto-an√°lisis del Grado I, pero ahora en relaci√≥n con las facultades intelectuales de su esp√≠ritu: Voluntad (Fuego), Intelecto (Aire), Sentimiento (Agua), Conciencia (Tierra). Determine cu√°l predomina y cu√°l necesita fortalecimiento.</p>
        `,
        'g7_a_clariv': `
            <h3>Desarrollo de la Clarividencia M√°gica</h3>
            <p>Desarrollo del "Ojo M√°gico" para ver en el plano astral y m√°s all√°.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Represe luz universal en sus ojos (como en Grado 3).</li>
                <li>Cargue un <strong>espejo m√°gico</strong> (ver Herramientas) con Akasha o luz.</li>
                <li>Mire el espejo (no su reflejo). Proyecte su deseo de ver algo (ej. el aura de una persona).</li>
                <li>Con pr√°ctica, ver√° im√°genes, auras o seres.</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> No fuerce la clarividencia con drogas. Esto es peligroso y lleva a la locura.</div>
        `,
        'g7_a_clariau': `
            <h3>Desarrollo de la Clariaudiencia M√°gica</h3>
            <p>Desarrollo del "O√≠do M√°gico" para escuchar en el plano astral.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Cargue su cuerpo con el elemento Aire (azul) como en Grado 3.</li>
                <li>Ponga 2 bolitas de algod√≥n impregnadas con condensador flu√≠dico (ver Herramientas) en sus o√≠dos.</li>
                <li>Conc√©ntrese en la regi√≥n del o√≠do y desee escuchar voces astrales.</li>
                <li>Al principio, ser√°n pensamientos, luego voces internas, luego voces externas.</li>
            </ol>
        `,
        'g7_a_sensit': `
            <h3>Desarrollo de la Clarinsentencia M√°gica</h3>
            <p>Desarrollo del "Tacto M√°gico" para sentir en el plano astral.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Cargue su cuerpo con el elemento Agua (plateado) como en Grado 3.</li>
                <li>Ponga un pedazo de franela con condensador flu√≠dico en el plexo solar (est√≥mago).</li>
                <li>Conc√©ntrese en esa regi√≥n y desee sentir vibraciones, emociones o la presencia de seres.</li>
            </ol>
        `,
        'g7_p_elem': `
            <h3>Generaci√≥n de Elementarios</h3>
            <p>Creaci√≥n de entidades semindependientes usando energ√≠as de la naturaleza.</p>
            <p><b>Instrucci√≥n:</b> Use los mismos 4 m√©todos de creaci√≥n que para los Elementales (Grado 6), pero ahora extraiga la energ√≠a no solo de su propio cuerpo, sino directamente del universo o de una fuente natural espec√≠fica (ej. un √°rbol, un r√≠o).</p>
            <div class="warning-box"><b>Advertencia:</b> Los Elementarios son m√°s poderosos que los Elementales. Requieren mayor maestr√≠a y √©tica, ya que tienen m√°s autonom√≠a.</div>
        `,

        // --- GRADO VIII ---
        'g8_m_travel': `
            <h3>Viaje Mental (Proyecci√≥n del Esp√≠ritu)</h3>
            <p>El "viaje fuera del cuerpo" del esp√≠ritu (cuerpo mental). M√°s seguro que el viaje astral.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Entre en profundo vac√≠o mental (Grado 1).</li>
                <li>Imagine que su conciencia se desliza fuera de su cuerpo f√≠sico y mental.</li>
                <li>Visual√≠cese de pie junto a su cuerpo. Intente ver la habitaci√≥n desde esa perspectiva.</li>
                <li>Progrese a viajar a lugares cercanos, luego remotos. No hay tiempo ni espacio en el plano mental.</li>
            </ol>
            <p><b>Meta:</b> Viajar a cualquier lugar del planeta al instante, observando con claridad.</p>
        `,
        'g8_a_fluids': `
            <h3>Dominio de los Fluidos El√©ctrico y Magn√©tico</h3>
            <p>El Gran Arcano. La manipulaci√≥n de las fuerzas que sustentan la creaci√≥n.</p>
            <p><b>Instrucci√≥n (Inductivo - Absorci√≥n):</b></p>
            <ol>
                <li><b>El√©ctrico (Rojo, expansivo):</b> Imagine el universo lleno de fluido el√©ctrico. Inhale y abs√≥rbalo en su cuerpo, sintiendo calor y presi√≥n hasta que su cuerpo irradie como un sol.</li>
                <li><b>Magn√©tico (Azul, contractivo):</b> Imagine el universo lleno de fluido magn√©tico. Inhale y abs√≥rbalo en su cuerpo, sintiendo fr√≠o y pesadez hasta que su cuerpo sea un im√°n.</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> Despu√©s de cada ejercicio, SIEMPRE disuelva el fluido en el universo para evitar sobrecargas y da√±os al cuerpo.</div>
            <p><b>Instrucci√≥n (Deductivo - Proyecci√≥n):</b> Inhale el fluido, ret√©ngalo y luego proy√©ctelo fuera del cuerpo hacia el universo. Este es el m√©todo para influenciar.</p>
        `,
        'g8_p_condens': `
            <h3>Preparaci√≥n de Condensadores Flu√≠dicos (II)</h3>
            <p>Creaci√≥n avanzada de sustancias alqu√≠micas capaces de retener cargas m√°gicas enormes.</p>
            <p><b>Condensador Compuesto (Universal):</b> Se crea mezclando extractos de diversas hierbas (ang√©lica, salvia, tilo, pepino, acacia, manzanilla, azucena, canela, ortiga, menta, √°lamo, violeta, sauce, tabaco) con tintura de oro. Se carga m√°gicamente con un deseo universal.</p>
            <p><b>Uso:</b> Para pintar espejos m√°gicos, cargar varas, amuletos, o consumo personal (diluido homeop√°ticamente) para fortalecer el alma y el cuerpo.</p>
        `,

        // --- GRADO IX ---
        'g9_m_mirror': `
            <h3>Espejo M√°gico (Uso Avanzado)</h3>
            <p>El espejo se convierte en un portal y un instrumento de influencia.</p>
            <p><b>Funciones:</b></p>
            <ul>
                <li><b>Visi√≥n a Distancia:</b> Vea lugares remotos, personas y eventos actuales.</li>
                <li><b>Visi√≥n a trav√©s del Tiempo:</b> Acceda al Akasha para ver el pasado y las probabilidades del futuro.</li>
                <li><b>Proyecci√≥n de Influencias:</b> Env√≠e energ√≠a, elementales o pensamientos a personas distantes a trav√©s del espejo.</li>
            </ul>
        `,
        'g9_a_travel': `
            <h3>Viaje Astral (Proyecci√≥n del Alma)</h3>
            <p>La separaci√≥n consciente del cuerpo Astral (alma) del cuerpo f√≠sico.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Relaje el cuerpo f√≠sico hasta un estado de catalepsia (muerte aparente).</li>
                <li>Imagine que su cuerpo astral se desliza fuera del f√≠sico, conectado por el <strong>Cord√≥n de Plata</strong>.</li>
                <li>Viaje por el plano astral.</li>
                <li>Para regresar, visualice el cuerpo astral volviendo al f√≠sico y respire profundamente.</li>
            </ol>
            <div class="warning-box"><b>¬°ADVERTENCIA DE PELIGRO!</b> El cord√≥n de plata es vital. Si se rompe o se da√±a por un impacto f√≠sico en el cuerpo astral o por un choque repentino con el cuerpo f√≠sico, ocurre la muerte. NUNCA realice este ejercicio si no est√° preparado.</div>
        `,
        'g9_p_volts': `
            <h3>Carga de Volts y Talismanes</h3>
            <p>Creaci√≥n de "Volts" (esferas de energ√≠a concentrada) y Talismanes permanentes.</p>
            <p><b>Instrucci√≥n (Volt Electromagn√©tico):</b></p>
            <ol>
                <li>Proyecte fluido el√©ctrico (rojo) desde su lado derecho del cuerpo formando una esfera brillante.</li>
                <li>Proyecte fluido magn√©tico (azul) desde su lado izquierdo del cuerpo, envolviendo la esfera el√©ctrica.</li>
                <li>Esto crea un "Volt" electromagn√©tico (p√∫rpura). Impregne este volt con su deseo.</li>
            </ol>
            <p><b>Talismanes:</b> Cargue objetos (piedras, metales) con estos volts o con su voluntad directa para fines espec√≠ficos (protecci√≥n, suerte, amor).</p>
        `,

        // --- GRADO X ---
        'g10_m_planes': `
            <h3>Ascensi√≥n a los Planos Superiores (Esferas Planetarias)</h3>
            <p>El mago eleva su esp√≠ritu a las esferas del √Årbol de la Vida para contactar con inteligencias superiores.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Entre en trance Ak√°shico (Grado 6).</li>
                <li>Conc√©ntrese en su deseo de ascender a una esfera espec√≠fica (ej. Luna, Mercurio, Venus, Sol, Marte, J√∫piter, Saturno).</li>
                <li>Sentir√° un "remolino" que lo eleva.</li>
                <li>En cada esfera, intente contactar con sus inteligencias correspondientes para aprender sus leyes y secretos.</li>
            </ol>
            <div class="warning-box"><b>Advertencia:</b> Este paso no debe intentarse sin dominar los grados anteriores y tener un car√°cter impecable, o podr√≠a ser da√±ado por las vibraciones de las esferas.</div>
        `,
        'g10_a_deity': `
            <h3>Comuni√≥n con el Dios Personal</h3>
            <p>La unificaci√≥n final con la Divina Providencia.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Medite profundamente en su concepto m√°s elevado de Dios.</li>
                <li>Conc√©ntrese en las cuatro virtudes divinas (Fuego, Aire, Agua, Tierra):
                    <ul>
                        <li><b>Omnipotencia (Fuego).</b></li>
                        <li><b>Sabidur√≠a/Omnisciencia (Aire).</b></li>
                        <li><b>Amor/Misericordia (Agua).</b></li>
                        <li><b>Inmortalidad/Inmutabilidad (Tierra).</b></li>
                    </ul>
                </li>
                <li>Sienta que usted SE CONVIERTE en esas virtudes. No es una adoraci√≥n externa, sino una fusi√≥n interna.</li>
            </ol>
        `,
        'g10_p_powers': `
            <h3>Poderes Externos y C√°bala Pr√°ctica</h3>
            <p>El Adepto. El dominio de la palabra m√°gica y sus efectos f√≠sicos directos.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>Uso de la **Llave Cu√°druple (Jod-He-Vau-He)** para la creaci√≥n directa.</li>
                <li>Pronunciar letras c√≥smicas con conciencia mental, astral y f√≠sica para materializar deseos.</li>
                <li>Facultades como la teletransportaci√≥n de objetos, invisibilidad f√≠sica y materializaci√≥n directa.</li>
            </ul>
        `,

        // --- HERRAMIENTAS ---
        'tool_mirror': `<h3>El Espejo M√°gico</h3><p><b>Material:</b> Vidrio c√≥ncavo (como de reloj antiguo) o superficie plana negra brillante.<br><b>Construcci√≥n:</b> Limpie el vidrio. Aplique varias capas de laca negra brillante o nitrato de plata en el lado convexo (trasero). Puede a√±adir gotas de condensador flu√≠dico en la pintura.<br><b>Uso:</b> C√°rgalo con Akasha o Luz imaginaria. No mires tu reflejo f√≠sico (desenfoca la vista), mira "a trav√©s" de la superficie hacia el infinito negro. Sirve para desarrollar la visi√≥n astral y contactar inteligencias.</p>`,
        'tool_wand': `<h3>La Vara M√°gica</h3><p>Simboliza la Voluntad Absoluta y el Elemento Fuego/Aire.<br><b>Simple:</b> Rama de avellano (cortada virgen) o fresno. Limpia y magnetizada.<br><b>Compleja (Modelo Bardon):</b> Tubo de acero (magneto) con un hilo de cobre en el centro, aislado, con condensador s√≥lido o l√≠quido dentro. Polarizada (+/-).<br><b>Uso:</b> Para proyectar fuerza concentrada, trazar c√≠rculos de protecci√≥n, cargar objetos y mandar a seres elementales.</p>`,
        'tool_lamp': `<h3>La L√°mpara M√°gica (Linterna M√°gica)</h3><p>Instrumento para crear atm√≥sferas elementales y planetarias en el espacio ritual.<br><b>Construcci√≥n:</b> Una l√°mpara de aceite o el√©ctrica simple. Se cubre con papel celof√°n o vidrios de colores.<br><b>Colores y Elementos:</b><br>Rojo: Fuego (Voluntad).<br>Azul: Aire (Intelecto).<br>Verde: Agua (Sentimiento).<br>Amarillo: Tierra (Conciencia).<br>Violeta/Negro: Akasha.</p>`,
        'tool_fluid': `<h3>Condensadores Flu√≠dicos</h3><p>Sustancias l√≠quidas o s√≥lidas capaces de retener y amplificar cargas m√°gicas. Son como bater√≠as energ√©ticas.<br><b>Simple:</b> Infusi√≥n muy fuerte de manzanilla, t√© negro o lila.<br><b>Compuesto (Universal):</b> Mezclas complejas de extractos alcoh√≥licos de diversas hierbas (Ang√©lica, Salvia, Tilo, Pepino, Acacia, Manzanilla, Azucena, Canela, Ortiga, Menta, √Ålamo, Violeta, Sauce, Tabaco) + Tintura de Oro.<br><b>Uso:</b> Pintar espejos m√°gicos, impregnar varas, amuletos, o consumo personal (diluido homeop√°ticamente) para fortalecer el alma y el cuerpo.</p>`,
        'tool_pentacle': `<h3>El Pent√°culo</h3><p>Disco de cera virgen, madera o metal que simboliza el cuerpo y el elemento Tierra. Se usa como un "suelo m√°gico".<br><b>Uso:</b> Se graba con s√≠mbolos pertinentes a la operaci√≥n. Se usa para protecci√≥n, para evocar energ√≠as terrestres y como "tierra" para descargar energ√≠as sobrantes de los elementales.</p>`
    };

    /* =========================================
       CONFIGURACI√ìN DE GRADOS (10 GRADOS)
       ========================================= */
    const gradesData = [
        {
            id: 'g1', 
            title: 'Grado I', 
            sub: 'Fundamentos del Yo',
            tasks: [
                {id: 't1_1', text: 'Mental: Control del Pensamiento', type: 'mental', target: 14, ref: 'g1_m_obs'},
                {id: 't1_2', text: 'Mental: Disciplina (Un solo pensamiento)', type: 'mental', target: 14, ref: 'g1_m_disc'},
                {id: 't1_3', text: 'Mental: Vac√≠o Mental', type: 'mental', target: 21, ref: 'g1_m_vaci'},
                {id: 't1_4', text: 'Astral: Espejo del Alma (Introspecci√≥n)', type: 'astral', target: 14, ref: 'g1_a_magic'},
                {id: 't1_5', text: 'F√≠sico: Higiene Energ√©tica', type: 'fisico', target: 30, ref: 'g1_p_skin'},
                {id: 't1_6', text: 'F√≠sico: Respiraci√≥n Consciente', type: 'fisico', target: 30, ref: 'g1_p_breath'},
                {id: 't1_7', text: 'F√≠sico: Magia del Agua y Comida', type: 'fisico', target: 30, ref: 'g1_p_euc'}
            ]
        },
        {
            id: 'g2', 
            title: 'Grado II', 
            sub: 'Autosugesti√≥n y Concentraci√≥n Sensorial',
            tasks: [
                {id: 't2_1', text: 'Mental: Autosugesti√≥n', type: 'mental', target: 21, ref: 'g2_mental'},
                {id: 't2_2', text: 'Mental: Concentraci√≥n Sensorial (5 sentidos)', type: 'mental', target: 14, ref: 'g2_sensory'},
                {id: 't2_3', text: 'Astral: Transmutaci√≥n del Car√°cter', type: 'astral', target: 21, ref: 'g2_astral'},
                {id: 't2_4', text: 'F√≠sico: Respiraci√≥n por los Poros', type: 'fisico', target: 14, ref: 'g2_physical'},
                {id: 't2_5', text: 'F√≠sico: Dominio del Cuerpo (Inmovilidad)', type: 'fisico', target: 14, ref: 'g2_body'}
            ]
        },
        {
            id: 'g3', 
            title: 'Grado III', 
            sub: 'Respiraci√≥n y Proyecci√≥n Elemental',
            tasks: [
                {id: 't3_1', text: 'Mental: Visualizaci√≥n Multisensorial', type: 'mental', target: 14, ref: 'g3_mental'},
                {id: 't3_2', text: 'Mental: Proyecci√≥n de Im√°genes Externas', type: 'mental', target: 14, ref: 'g3_mental'},
                {id: 't3_3', text: 'Astral: Inhalaci√≥n de Elementos', type: 'astral', target: 21, ref: 'g3_astral'},
                {id: 't3_4', text: 'F√≠sico: Acumulaci√≥n de Energ√≠a Vital', type: 'fisico', target: 14, ref: 'g3_physical'}
            ]
        },
        {
            id: 'g4', 
            title: 'Grado IV', 
            sub: 'Rituales y Transferencia de Conciencia',
            tasks: [
                {id: 't4_1', text: 'Mental: Transposici√≥n de Conciencia', type: 'mental', target: 14, ref: 'g4_mental'},
                {id: 't4_2', text: 'Astral: Acumulaci√≥n Elemental (Cuerpo)', type: 'astral', target: 20, ref: 'g4_astral'},
                {id: 't4_3', text: 'F√≠sico: Creaci√≥n de Rituales', type: 'fisico', target: 7, ref: 'g4_physical'}
            ]
        },
        {
            id: 'g5', 
            title: 'Grado V', 
            sub: 'Akasha y Comunicaci√≥n M√°gica',
            tasks: [
                {id: 't5_1', text: 'Mental: Magia del Espacio (Punto Central)', type: 'mental', target: 14, ref: 'g5_m_space'},
                {id: 't5_2', text: 'Astral: Proyecci√≥n Exterior de Elementos', type: 'astral', target: 20, ref: 'g5_a_proj'},
                {id: 't5_3', text: 'F√≠sico: Comunicaci√≥n Pasiva (P√©ndulo/Mano)', type: 'fisico', target: 14, ref: 'g5_p_comm'}
            ]
        },
        {
            id: 'g6', 
            title: 'Grado VI', 
            sub: 'Elementales y Trance Ak√°shico',
            tasks: [
                {id: 't6_1', text: 'Mental: Meditaci√≥n en el Propio Esp√≠ritu', type: 'mental', target: 14, ref: 'g6_m_spirit'},
                {id: 't6_2', text: 'Astral: Inducci√≥n de Trance Ak√°shico', type: 'astral', target: 14, ref: 'g6_a_akasha'},
                {id: 't6_3', text: 'F√≠sico: Generaci√≥n de Elementales', type: 'fisico', target: 7, ref: 'g6_p_elem'}
            ]
        },
        {
            id: 'g7', 
            title: 'Grado VII', 
            sub: 'Desarrollo de Sentidos Astrales',
            tasks: [
                {id: 't7_1', text: 'Mental: An√°lisis del Esp√≠ritu (II)', type: 'mental', target: 7, ref: 'g7_m_spirit'},
                {id: 't7_2', text: 'Astral: Desarrollo de Clarividencia', type: 'astral', target: 21, ref: 'g7_a_clariv'},
                {id: 't7_3', text: 'Astral: Desarrollo de Clariaudiencia', type: 'astral', target: 21, ref: 'g7_a_clariau'},
                {id: 't7_4', text: 'Astral: Desarrollo de Clarinsentencia', type: 'astral', target: 21, ref: 'g7_a_sensit'},
                {id: 't7_5', text: 'F√≠sico: Generaci√≥n de Elementarios', type: 'fisico', target: 7, ref: 'g7_p_elem'}
            ]
        },
        {
            id: 'g8', 
            title: 'Grado VIII', 
            sub: 'Viaje Mental y Fluidos',
            tasks: [
                {id: 't8_1', text: 'Mental: Viaje Mental (Proyecci√≥n del Esp√≠ritu)', type: 'mental', target: 21, ref: 'g8_m_travel'},
                {id: 't8_2', text: 'Astral: Dominio de Fluidos El√©ctrico y Magn√©tico', type: 'astral', target: 21, ref: 'g8_a_fluids'},
                {id: 't8_3', text: 'F√≠sico: Preparaci√≥n de Condensadores Flu√≠dicos (II)', type: 'fisico', target: 7, ref: 'g8_p_condens'}
            ]
        },
        {
            id: 'g9', 
            title: 'Grado IX', 
            sub: 'Viaje Astral y Talismanes',
            tasks: [
                {id: 't9_1', text: 'Mental: Espejo M√°gico (Uso Avanzado)', type: 'mental', target: 14, ref: 'g9_m_mirror'},
                {id: 't9_2', text: 'Astral: Viaje Astral (Proyecci√≥n del Alma)', type: 'astral', target: 21, ref: 'g9_a_travel'},
                {id: 't9_3', text: 'F√≠sico: Carga de Volts y Talismanes', type: 'fisico', target: 7, ref: 'g9_p_volts'}
            ]
        },
        {
            id: 'g10', 
            title: 'Grado X', 
            sub: 'Uni√≥n Divina y Maestr√≠a Universal',
            tasks: [
                {id: 't10_1', text: 'Mental: Ascensi√≥n a los Planos Superiores', type: 'mental', target: 30, ref: 'g10_m_planes'},
                {id: 't10_2', text: 'Astral: Comuni√≥n con el Dios Personal', type: 'astral', target: 30, ref: 'g10_a_deity'},
                {id: 't10_3', text: 'F√≠sico: Poderes Externos y C√°bala Pr√°ctica', type: 'fisico', target: 14, ref: 'g10_p_powers'}
            ]
        }
    ];

    /* =========================================
       L√ìGICA DE LA APLICACI√ìN (CORREGIDA)
       ========================================= */

    let userProgress = JSON.parse(localStorage.getItem('bardonFullProgress')) || {};
    let currentOpenGradeId = localStorage.getItem('currentOpenGrade') || null; // Persistir el estado del grado abierto

    // Inicializar progreso si est√° vac√≠o
    if (Object.keys(userProgress).length === 0) {
        gradesData.forEach(g => {
            g.tasks.forEach(t => userProgress[t.id] = 0);
        });
        localStorage.setItem('bardonFullProgress', JSON.stringify(userProgress));
    }

    function renderView(viewName) {
        // Actualizar estilos de los botones de navegaci√≥n
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        if(viewName === 'training') document.querySelectorAll('.nav-btn')[0].classList.add('active');
        if(viewName === 'tools') document.querySelectorAll('.nav-btn')[1].classList.add('active');
        if(viewName === 'library') document.querySelectorAll('.nav-btn')[2].classList.add('active');

        const container = document.getElementById('main-view');
        container.innerHTML = ''; 

        if (viewName === 'training') renderTraining(container);
        if (viewName === 'tools') renderTools(container);
        if (viewName === 'library') renderLibrary(container);
        
        window.scrollTo(0, 0); // Desplazar al inicio de la p√°gina al cambiar de vista
    }

    function renderTraining(container) {
        let isPreviousGradeComplete = true; // Para el sistema de bloqueo

        gradesData.forEach((grade) => {
            let currentGradeTasksComplete = true;
            grade.tasks.forEach(t => {
                if (userProgress[t.id] < t.target) currentGradeTasksComplete = false;
            });

            const isLocked = !isPreviousGradeComplete;
            const completedClass = currentGradeTasksComplete ? 'completed' : '';
            const lockedClass = isLocked ? 'locked' : '';
            const icon = isLocked ? 'üîí' : (currentGradeTasksComplete ? '‚úì' : '‚úß');

            const gradeHTML = document.createElement('div');
            gradeHTML.className = 'grade-wrapper';
            gradeHTML.innerHTML = `
                <div class="grade-header ${lockedClass} ${completedClass}" onclick="toggleGrade('list-${grade.id}', ${isLocked})">
                    <div>
                        <div class="grade-title">${grade.title}</div>
                        <div class="grade-info">${grade.sub}</div>
                    </div>
                    <div style="font-size:1.5rem; color:var(--accent-gold);">${icon}</div>
                </div>
                <div id="list-${grade.id}" class="exercises-list">
                    ${renderTasks(grade.tasks, isLocked)}
                </div>
            `;
            container.appendChild(gradeHTML);

            // Abre el grado si es el que estaba abierto ANTES de re-renderizar
            if (currentOpenGradeId === `list-${grade.id}` && !isLocked) {
                 document.getElementById(`list-${grade.id}`).classList.add('open');
            }

            if (!currentGradeTasksComplete) isPreviousGradeComplete = false; // Actualiza el estado de bloqueo para el siguiente grado
        });
        
        // Mensaje final si todos los grados est√°n completos
        if(isPreviousGradeComplete) {
             const congrats = document.createElement('div');
             congrats.innerHTML = `<div style="text-align:center; padding:20px; color:var(--accent-gold-light); border:1px solid var(--accent-gold); margin-top:30px; border-radius:10px; box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);"><h3>¬°MAESTR√çA ALCANZADA!</h3><p>Has completado el camino de la Iniciaci√≥n al Hermetismo.</p><p>Que la Luz Divina te gu√≠e.</p></div>`;
             container.appendChild(congrats);
        }
    }

    function renderTasks(tasks, isLocked) {
        if (isLocked) return `<div style="padding:15px; color:var(--text-muted); font-style:italic; text-align:center;">Completa el grado anterior para desbloquear los misterios de este nivel.</div>`;
        
        return tasks.map(t => {
            const currentReps = userProgress[t.id] || 0;
            const percentage = Math.min(100, Math.floor((currentReps / t.target) * 100));
            const isDone = currentReps >= t.target;
            const btnText = isDone ? 'Completado' : 'Registrar (+1)';
            const btnDisabled = isDone ? 'disabled' : '';
            
            // Determinar clase para el tag
            let tagClass = '';
            if(t.type === 'mental') tagClass = 'mental';
            else if(t.type === 'astral') tagClass = 'astral';
            else if(t.type === 'fisico') tagClass = 'fisico';

            return `
            <div class="exercise-card">
                <span class="ex-tag ${tagClass}">${t.type.toUpperCase()}</span>
                <div class="ex-title">${t.text}</div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span>Progreso: ${currentReps}/${t.target} d√≠as</span>
                        <span>${percentage}%</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" style="width:${percentage}%"></div>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-theory" onclick="showTheory('${t.ref}', '${t.text}')">
                        üìñ Teor√≠a
                    </button>
                    <button class="btn btn-train" onclick="addProgress('${t.id}', ${t.target})" ${btnDisabled}>
                        ‚ö° ${btnText}
                    </button>
                </div>
            </div>
            `;
        }).join('');
    }

    function renderTools(container) {
        container.innerHTML = `
            <h2 style="color:var(--accent-gold); text-align:center; font-family:'Cinzel', serif; margin-bottom:20px;">Instrumentarium M√°gico</h2>
            <div class="tool-grid">
                <div class="tool-item" onclick="showTheory('tool_mirror', 'El Espejo M√°gico')"><span class="tool-icon">üîÆ</span><div class="tool-text">Espejo M√°gico</div></div>
                <div class="tool-item" onclick="showTheory('tool_wand', 'La Vara M√°gica')"><span class="tool-icon">ü™Ñ</span><div class="tool-text">Vara de Poder</div></div>
                <div class="tool-item" onclick="showTheory('tool_fluid', 'Condensadores')"><span class="tool-icon">‚öóÔ∏è</span><div class="tool-text">Condensadores</div></div>
                <div class="tool-item" onclick="showTheory('tool_pentacle', 'El Pent√°culo')"><span class="tool-icon">‚õ§</span><div class="tool-text">Pent√°culo</div></div>
                 <div class="tool-item" onclick="showTheory('tool_lamp', 'La L√°mpara M√°gica')"><span class="tool-icon">üèÆ</span><div class="tool-text">L√°mpara M√°gica</div></div>
            </div>
            <h3 style="color:var(--accent-teal-bright); margin-top:30px; text-align:center; font-family:'Cinzel', serif;">Los Tattwas (S√≠mbolos Elementales)</h3>
            <div style="background:var(--bg-card); padding:20px; border-radius:10px; margin-top:10px; text-align:center; border:1px solid rgba(255,255,255,0.05);">
                <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">Formas geom√©tricas para la meditaci√≥n elemental y Ak√°shica.</p>
                <div class="tattwa-box">
                    <div class="tattwa-wrapper"><div class="tattwa-akasha"></div><small style="font-size:0.7em; color:var(--text-muted)">Akasha (√âter)</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-fire"></div><small style="font-size:0.7em; color:var(--text-muted)">Tejas (Fuego)</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-air"></div><small style="font-size:0.7em; color:var(--text-muted)">Waju (Aire)</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-water"></div><small style="font-size:0.7em; color:var(--text-muted)">Apas (Agua)</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-earth"></div><small style="font-size:0.7em; color:var(--text-muted)">Prithivi (Tierra)</small></div>
                </div>
            </div>
        `;
    }

    function renderLibrary(container) {
        container.innerHTML = `
            <h2 style="color:var(--accent-gold); text-align:center; font-family:'Cinzel', serif; margin-bottom:20px;">Archivo Herm√©tico</h2>
            <div class="exercise-card"><div class="ex-title" style="color:var(--accent-gold);">Iniciaci√≥n al Hermetismo</div><p class="ex-desc">El curso base de 10 grados de Franz Bardon. Un sendero sistem√°tico para el desarrollo del mago, cubriendo los aspectos mental, astral y f√≠sico para alcanzar la maestr√≠a.</p></div>
            <div class="exercise-card"><div class="ex-title" style="color:var(--accent-teal-bright);">La Pr√°ctica de la Evocaci√≥n M√°gica</div><p class="ex-desc">La segunda obra de Bardon, gu√≠a para contactar inteligencias de las esferas planetarias y elementales. Detalla el uso del c√≠rculo m√°gico, el tri√°ngulo y los sigilos.</p></div>
            <div class="exercise-card"><div class="ex-title" style="color:#b388ff;">La Clave de la Verdadera C√°bala</div><p class="ex-desc">La tercera obra de Bardon, que explora el misterio de la palabra, el sonido y las letras c√≥smicas para la creaci√≥n m√°gica. Profundiza en el lenguaje universal.</p></div>
            <div style="text-align:center; margin-top:20px; font-size:0.8rem; color:var(--text-muted);"><p>"El saber no es suficiente; debemos aplicar. El querer no es suficiente; debemos hacer."</p></div>
        `;
    }

    // --- INTERACCIONES Y L√ìGICA DE ESTADO ---

    // Funci√≥n para alternar la visibilidad de la lista de ejercicios de un grado
    function toggleGrade(elementId, isLocked) {
        if (isLocked) { 
            // Efecto de vibraci√≥n para grados bloqueados
            const header = document.querySelector(`.grade-header.locked[onclick*="${elementId}"]`);
            if(header) {
                header.style.animation = 'none'; // Reset animation
                void header.offsetWidth; // Trigger reflow
                header.style.animation = 'shake 0.3s'; // Apply shake animation
            }
            alert("Este grado est√° sellado. Completa el grado anterior para obtener la llave.");
            return; 
        }

        const el = document.getElementById(elementId);
        const isOpen = el.classList.contains('open');

        // Cierra todos los dem√°s grados si est√°n abiertos (comportamiento de acorde√≥n)
        document.querySelectorAll('.exercises-list.open').forEach(list => {
            if (list.id !== elementId) {
                list.classList.remove('open');
            }
        });

        if (!isOpen) { // Si estaba cerrado, √°brelo
            el.classList.add('open');
            currentOpenGradeId = elementId; // Almacena el ID del grado abierto
        } else { // Si estaba abierto, ci√©rralo
            el.classList.remove('open');
            currentOpenGradeId = null; // No hay ning√∫n grado abierto
        }
        localStorage.setItem('currentOpenGrade', currentOpenGradeId); // Persiste el estado
    }

    // Funci√≥n para a√±adir progreso a un ejercicio
    function addProgress(taskId, target) {
        if (userProgress[taskId] < target) {
            userProgress[taskId]++;
            localStorage.setItem('bardonFullProgress', JSON.stringify(userProgress));
            
            // Re-renderiza la vista de entrenamiento para actualizar las barras y el estado de bloqueo
            renderView('training');
            
            // Despu√©s de re-renderizar, intenta reabrir el grado que estaba abierto
            if (currentOpenGradeId) {
                const el = document.getElementById(currentOpenGradeId);
                // Aseg√∫rate de que el elemento existe y que su padre (grade-header) no est√° bloqueado antes de intentar abrirlo
                if (el && !el.previousElementSibling.classList.contains('locked')) {
                    el.classList.add('open');
                } else { // Si el grado previamente abierto se ha bloqueado (ej. al completar un pre-requisito), resetea el estado
                    currentOpenGradeId = null;
                    localStorage.removeItem('currentOpenGrade');
                }
            }
        }
    }

    // Funci√≥n para mostrar el modal de teor√≠a
    function showTheory(key, title) {
        const modal = document.getElementById('appModal');
        const modalBody = document.getElementById('modal-body');
        
        // Limpiar contenido anterior
        modalBody.innerHTML = '';
        
        // A√±adir el nuevo contenido
        const content = libraryData[key] || "<p>Informaci√≥n detallada disponible en los textos originales de Franz Bardon.</p>";
        modalBody.innerHTML = `<h3>${title}</h3>${content}`;
        
        modal.style.display = "block";
    }

    // Funci√≥n para cerrar el modal
    function closeModal() {
        document.getElementById('appModal').style.display = "none";
    }
    
    // Funci√≥n para confirmar y reiniciar el progreso
    function resetProgressConfirm() {
        if(confirm("ATENCI√ìN:\n\nEsto borrar√° TODO tu progreso de los 10 grados.\n\n¬øEst√°s absolutamente seguro de que deseas reiniciar tu entrenamiento herm√©tico?")) {
            localStorage.removeItem('bardonFullProgress');
            localStorage.removeItem('currentOpenGrade'); // Tambi√©n resetea el grado abierto
            location.reload(); // Recarga la p√°gina para aplicar el reset
        }
    }

    // Cerrar modal al hacer clic fuera
    window.onclick = function(event) {
        const modal = document.getElementById('appModal');
        if (event.target == modal && modal.style.display === "block") { // Solo cerrar si el modal est√° visible
            modal.style.display = "none";
        }
    }

    // Inicializar la vista de entrenamiento al cargar la p√°gina
    renderView('training');
    
    // Animaci√≥n para el efecto de "sacudida" en el bloqueo
    const style = document.createElement('style');
    style.innerHTML = `
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    `;
    document.head.appendChild(style);

</script>
</body>
</html>
