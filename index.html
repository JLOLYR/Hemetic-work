<!DOCTYPE html>
<html lang="es">
<link rel="manifest" href="manifest.json">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adonai: Sendero Herm√©tico</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #080b10;
            --bg-card: rgba(22, 33, 49, 0.95);
            --bg-header: rgba(11, 16, 22, 0.98);
            --accent-gold: #d4af37;
            --accent-gold-light: #f3e5ab;
            --accent-teal: #1c5d66;
            --accent-teal-bright: #4db6ac;
            --text-main: #e0e0e0;
            --text-muted: #8c9bb0;
            --success: #2e7d32;
            --locked: #444;
            --border-color: rgba(212, 175, 55, 0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 5% 10%, rgba(28, 93, 102, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 95% 90%, rgba(212, 175, 55, 0.08) 0%, transparent 40%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            padding: 20px 15px;
            text-align: center;
            background: var(--bg-header);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }

        h1 {
            font-family: 'Cinzel', serif;
            color: var(--accent-gold);
            margin: 0;
            font-size: 1.5rem;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        .subtitle {
            font-size: 0.7rem;
            color: var(--accent-teal-bright);
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .container {
            padding: 20px;
            max-width: 700px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-out;
        }

        /* --- TARJETAS DE GRADOS --- */
        .grade-wrapper { margin-bottom: 25px; position: relative; }
        
        .grade-wrapper:not(:last-child)::after {
            content: ''; position: absolute; left: 24px; bottom: -25px; height: 25px; width: 1px;
            background: linear-gradient(to bottom, var(--accent-gold), rgba(212, 175, 55, 0.05));
            z-index: 0; opacity: 0.4;
        }

        .grade-header {
            background: linear-gradient(145deg, #1f2b3e, #111821);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            position: relative;
            z-index: 1;
            transition: all 0.3s;
        }

        .grade-header:active { transform: scale(0.99); }
        
        .grade-header.locked {
            background: #121212;
            border-color: #2a2a2a;
            opacity: 0.7;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .grade-header.completed {
            border-left: 3px solid var(--success);
            background: linear-gradient(145deg, #1a241c, #0f1c13);
        }

        .grade-title { font-family: 'Cinzel', serif; font-weight: 700; color: var(--accent-gold-light); font-size: 1.1rem; }
        .grade-info { font-size: 0.75rem; color: var(--text-muted); margin-top: 2px; text-transform: uppercase; letter-spacing: 1px; }

        /* --- LISTA DE EJERCICIOS --- */
        .exercises-list {
            display: none;
            padding: 15px 0 0 10px;
            margin-left: 15px;
            border-left: 1px solid rgba(212, 175, 55, 0.1);
        }
        .exercises-list.open { display: block; animation: slideDown 0.3s ease-out; }

        .exercise-card {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.03);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .ex-tag {
            position: absolute; top: 0; right: 0;
            color: #111; font-size: 0.6rem; padding: 2px 8px;
            border-bottom-left-radius: 6px; font-weight: bold; text-transform: uppercase;
        }
        .ex-tag.mental { background: #b39ddb; }
        .ex-tag.astral { background: #ef9a9a; }
        .ex-tag.fisico { background: #a5d6a7; }

        .ex-title { font-weight: bold; font-size: 0.95rem; color: #fff; padding-right: 60px; margin-bottom: 15px; }

        /* PROGRESO */
        .progress-container { margin-bottom: 12px; }
        .progress-info { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px; }
        .progress-track { background: #0f151c; height: 6px; border-radius: 3px; overflow: hidden; border: 1px solid #333; }
        .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-teal), var(--accent-gold)); transition: width 0.4s ease; }

        /* BOTONES */
        .actions { display: flex; gap: 8px; }
        .btn {
            flex: 1; padding: 10px; border: none; border-radius: 4px;
            font-family: 'Lato', sans-serif; font-weight: bold; font-size: 0.8rem;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn:active { transform: translateY(2px); }
        .btn-train { background: var(--accent-gold); color: #0a0a0a; box-shadow: 0 0 10px rgba(212, 175, 55, 0.15); }
        .btn-train:disabled { background: var(--success); color: white; cursor: default; box-shadow: none; opacity: 0.9; }
        .btn-theory { background: transparent; border: 1px solid var(--accent-teal); color: var(--accent-teal-bright); }

        /* --- HERRAMIENTAS --- */
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .tool-item {
            background: var(--bg-card); padding: 20px; border-radius: 8px; text-align: center;
            border: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: 0.3s;
        }
        .tool-item:hover { border-color: var(--accent-gold); transform: translateY(-2px); }
        .tool-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .tool-text { font-size: 0.9rem; color: #ddd; }

        /* --- MENU INFERIOR --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(8, 11, 16, 0.98); backdrop-filter: blur(15px);
            display: flex; justify-content: space-around; padding: 10px 0;
            border-top: 1px solid var(--border-color); z-index: 100;
        }
        .nav-btn { background: none; border: none; color: #555; font-size: 0.65rem; display: flex; flex-direction: column; align-items: center; padding: 5px; cursor: pointer; transition: 0.2s; }
        .nav-btn.active { color: var(--accent-gold); transform: scale(1.1); }
        .nav-btn svg { width: 22px; height: 22px; margin-bottom: 4px; fill: currentColor; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 2000; overflow-y: auto; animation: fadeIn 0.3s; }
        .modal-content {
            background: #11161f; margin: 5% auto; width: 90%; max-width: 650px; padding: 25px;
            border-radius: 8px; border: 1px solid var(--accent-gold); color: #ccc;
            position: relative; box-shadow: 0 0 40px rgba(212, 175, 55, 0.1);
        }
        .close-modal { position: absolute; top: 15px; right: 15px; font-size: 28px; color: var(--accent-gold); cursor: pointer; line-height: 1; }
        .modal-body { margin-top: 10px; line-height: 1.7; font-size: 0.95rem; }
        .modal-body h3 { color: var(--accent-gold); font-family: 'Cinzel', serif; border-bottom: 1px solid #333; padding-bottom: 8px; margin-top: 25px; font-size: 1.2rem; }
        .modal-body h3:first-child { margin-top: 0; }
        .modal-body strong { color: #fff; }
        .modal-body ul, .modal-body ol { padding-left: 20px; color: #bbb; }
        .modal-body li { margin-bottom: 8px; }
        .warning-box { background: rgba(198, 40, 40, 0.1); border-left: 3px solid #c62828; padding: 10px; margin: 15px 0; font-size: 0.9rem; color: #ffcdd2; }

        /* TATTWAS CSS */
        .tattwa-box { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 20px;}
        .tattwa-wrapper { text-align: center; }
        .tattwa-fire { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 50px solid #e53935; margin: 0 auto; filter: drop-shadow(0 0 5px red);}
        .tattwa-water { width: 50px; height: 25px; background: silver; border-radius: 0 0 50px 50px; margin: 15px auto 0; border: 2px solid #fff; filter: drop-shadow(0 0 5px silver); }
        .tattwa-air { width: 50px; height: 50px; background: #2196f3; border-radius: 50%; margin: 0 auto; filter: drop-shadow(0 0 5px blue); }
        .tattwa-earth { width: 50px; height: 50px; background: #fdd835; margin: 0 auto; border: 1px solid #c6a700; filter: drop-shadow(0 0 5px yellow);}
        .tattwa-akasha { width: 40px; height: 55px; background: #000; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; margin: 0 auto; border: 1px solid #444; filter: drop-shadow(0 0 5px white);}

        @keyframes slideDown { from {opacity: 0; transform: translateY(-10px);} to {opacity: 1; transform: translateY(0);} }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

    </style>
</head>
<body>

<header>
    <h1>Adonai</h1>
    <div class="subtitle">La Senda del Verdadero Adepto</div>
</header>

<div id="main-view" class="container"></div>

<!-- Men√∫ Inferior -->
<nav class="nav-bar">
    <button class="nav-btn active" onclick="renderView('training')">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
        Pr√°ctica
    </button>
    <button class="nav-btn" onclick="renderView('tools')">
        <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
        Herramientas
    </button>
    <button class="nav-btn" onclick="renderView('library')">
        <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"/></svg>
        Biblioteca
    </button>
    <button class="nav-btn" onclick="resetProgressConfirm()">
        <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
        Reset
    </button>
</nav>

<!-- Modal -->
<div id="appModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div id="modal-body" class="modal-body"></div>
    </div>
</div>

<script>
    /* =========================================
       BASE DE DATOS DE CONTENIDO DETALLADO
       ========================================= */
    const libraryData = {
        // --- GRADO I ---
        'g1_m_obs': `
            <h3>Control del Pensamiento (Observaci√≥n)</h3>
            <p>Este es el primer paso y el m√°s crucial. La mente indisciplinada es el mayor enemigo del mago.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en una posici√≥n c√≥moda (Asana). Relaje todo el cuerpo. Cierre los ojos.</li>
                <li>Convi√©rtase en un <b>observador silencioso</b> de su propia mente.</li>
                <li>Observe c√≥mo los pensamientos vienen y van. No los detenga, no los juzgue, no se enoje si son ca√≥ticos.</li>
                <li>No se involucre en la "historia" de ning√∫n pensamiento. D√©jelos pasar como veh√≠culos en una carretera.</li>
            </ol>
            <p><b>Meta:</b> Debe lograr esto durante <b>10 minutos</b> completos sin perder la postura de observador y sin ser arrastrado por una cadena de pensamientos.</p>
        `,
        'g1_m_disc': `
            <h3>Disciplina Mental (Unidireccional)</h3>
            <p>Una vez que puede observar sus pensamientos, debe aprender a sostener uno solo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Elija un solo pensamiento o imagen simple (ej. una flor, una vela, la palabra "Luz").</li>
                <li>Mantenga ese pensamiento en el centro de su mente con toda su fuerza.</li>
                <li>Rechace en√©rgicamente cualquier otro pensamiento intruso y vuelva inmediatamente a su objeto elegido.</li>
            </ol>
            <p><b>Meta:</b> Mantener la imagen o idea durante <b>10 minutos</b> sin una sola interrupci√≥n.</p>
        `,
        'g1_m_vaci': `
            <h3>Vac√≠o Mental (Silencio)</h3>
            <p>Este es el fundamento de toda operaci√≥n m√°gica futura. Sin vac√≠o, no hay Akasha.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Cierre los ojos.</li>
                <li>Rechace en√©rgicamente cualquier pensamiento que intente aparecer.</li>
                <li>Cree un estado de vac√≠o absoluto. No debe haber im√°genes, ni palabras, ni m√∫sica interna. Solo silencio.</li>
            </ol>
            <p><b>Meta:</b> Lograr <b>10 minutos</b> de vac√≠o total sin quedarse dormido y sin perder la conciencia.</p>
        `,
        'g1_a_magic': `
            <h3>El Espejo M√°gico del Alma</h3>
            <p>El equilibrio elemental es la clave del poder. Un mago desequilibrado se destruir√° a s√≠ mismo.</p>
            <p><b>Instrucci√≥n (Introspecci√≥n):</b></p>
            <ol>
                <li>Tome un cuaderno privado (Diario M√°gico). Nadie m√°s debe verlo.</li>
                <li><b>Espejo Negro:</b> Haga una lista honesta y despiadada de todos sus defectos, debilidades, vicios y malos h√°bitos. No esconda nada.</li>
                <li><b>Espejo Blanco:</b> Haga otra lista con sus virtudes y fortalezas.</li>
                <li><b>Clasificaci√≥n Elemental:</b> Asigne cada defecto a un elemento:
                    <ul>
                        <li>üî• <b>Fuego:</b> Ira, celos, odio, impulsividad, deseo de destrucci√≥n.</li>
                        <li>üí® <b>Aire:</b> Frivolidad, presunci√≥n, chisme, inestabilidad, despilfarro.</li>
                        <li>üíß <b>Agua:</b> Indiferencia, frialdad, timidez, negligencia, inestabilidad emocional.</li>
                        <li>üåç <b>Tierra:</b> Pereza, melancol√≠a, lentitud, pesadez, materialismo.</li>
                    </ul>
                </li>
            </ol>
            <p><b>Meta:</b> Clasificar al menos 100 defectos antes de pasar al Grado 2.</p>
        `,
        'g1_p_skin': `
            <h3>Higiene Energ√©tica Diaria</h3>
            <p>El cuerpo debe estar preparado para manejar altas corrientes de energ√≠a.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li><b>Cepillado:</b> Cada ma√±ana, use un cepillo de cerdas naturales o toalla √°spera. Cepille todo el cuerpo en seco hasta que la piel se ponga rosada. Esto abre los poros para la respiraci√≥n vital.</li>
                <li><b>Agua Fr√≠a:</b> L√°vese la parte superior del cuerpo (o d√∫chese completo) con agua fr√≠a. Mientras lo hace, imagine firmemente que el agua elimina no solo el sudor, sino las enfermedades y malas vibraciones de su aura.</li>
            </ul>
        `,
        'g1_p_breath': `
            <h3>Respiraci√≥n Consciente de Aire</h3>
            <p>El aire transporta el principio Akasha y la energ√≠a vital.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese c√≥modamente. Respire por la nariz lenta y uniformemente.</li>
                <li><b>Imaginaci√≥n:</b> Al inhalar, imagine que el aire est√° cargado de un deseo espec√≠fico (ej. "Salud perfecta", "Paz", "√âxito").</li>
                <li>Sienta que esa idea entra en su sangre a trav√©s de los pulmones y se distribuye por todo el cuerpo.</li>
                <li>Al exhalar, expulse el aire "vac√≠o", pero retenga la idea/energ√≠a dentro de usted.</li>
            </ol>
            <p><b>Meta:</b> Iniciar con 7 respiraciones ma√±ana y noche. Aumentar 1 por d√≠a hasta llegar a 40.</p>
        `,
        'g1_p_euc': `
            <h3>Magia del Agua y Comida (Eucarist√≠a)</h3>
            <p>Todo lo que entra en el cuerpo puede ser una herramienta m√°gica.</p>
            <p><b>Comida:</b></p>
            <ul>
                <li>Si√©ntese ante su comida. Conc√©ntrese intensamente en que la comida contiene un deseo (ej. "Poder", "Salud").</li>
                <li>Imagine la comida irradiando esa cualidad. Coma lentamente, asimilando esa energ√≠a. No hable ni lea.</li>
            </ul>
            <p><b>Agua M√°gica:</b></p>
            <ul>
                <li>Tome un vaso de agua con la mano izquierda.</li>
                <li>Proyecte su deseo en el agua hasta que sienta que el agua "es" el deseo (ej. "Medicina universal"). B√©bela a sorbos peque√±os.</li>
            </ul>
        `,

        // --- GRADO II ---
        'g2_mental': `
            <h3>Autosugesti√≥n</h3>
            <p>El subconsciente es m√°s receptivo en los momentos de transici√≥n entre vigilia y sue√±o.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>Prepare una frase corta y positiva en tiempo presente (ej. "Yo estoy sano", "Mi memoria es perfecta").</li>
                <li>Justo antes de dormir y inmediatamente al despertar, repita esta frase mentalmente.</li>
                <li><b>El Collar:</b> Use un collar de cuentas o cuerda con nudos para contar 40 repeticiones. Esto evita que su mente consciente se distraiga contando n√∫meros.</li>
            </ul>
        `,
        'g2_sensory': `
            <h3>Concentraci√≥n Sensorial</h3>
            <p>El mago debe aprender a usar sus sentidos mentales con la misma claridad que los f√≠sicos.</p>
            <p><b>Pr√°ctica:</b> Dedique 5 minutos a cada sentido:</p>
            <ol>
                <li><b>Visual:</b> Visualice un objeto (ej. un l√°piz) con los ojos cerrados. Mantenga la imagen fija.</li>
                <li><b>Auditiva:</b> Escuche mentalmente el tic-tac de un reloj.</li>
                <li><b>Sensorial:</b> Sienta fr√≠o, calor o peso sin causa f√≠sica.</li>
                <li><b>Olfativa:</b> Huela el aroma de una rosa imaginaria.</li>
                <li><b>Gustativa:</b> Saboree az√∫car o lim√≥n imaginario.</li>
            </ol>
        `,
        'g2_astral': `
            <h3>Transmutaci√≥n del Car√°cter</h3>
            <p>Este es el trabajo de la "Piedra Filosofal" en el alma.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>Tome la lista de defectos del Grado 1 (Espejo Negro).</li>
                <li>Seleccione los defectos m√°s graves.</li>
                <li><b>M√©todo 1 (Voluntad):</b> Cada vez que surja el defecto, contrarr√©strelo conscientemente con la virtud opuesta.</li>
                <li><b>M√©todo 2 (Autosugesti√≥n):</b> Use el ejercicio mental de autosugesti√≥n para eliminar el defecto.</li>
            </ul>
            <p><b>Advertencia:</b> No intente avanzar a la magia de elementos si su car√°cter est√° desequilibrado. El elemento dominante lo destruir√°.</p>
        `,
        'g2_physical': `
            <h3>Respiraci√≥n por los Poros</h3>
            <p>El cuerpo puede respirar energ√≠a vital por cada c√©lula, no solo los pulmones.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese en Asana. Rel√°jese.</li>
                <li>Imagine que su piel tiene millones de peque√±os pulmones.</li>
                <li>Al inhalar, sienta que el aire vital (cargado de luz o salud) entra por cada poro de su cuerpo hasta llegar a los huesos.</li>
                <li>Sienta la presi√≥n de la energ√≠a vital dentro de usted.</li>
                <li>Al exhalar, imagine que expulsa impurezas y aire viciado por cada poro hacia afuera.</li>
            </ol>
        `,
        'g2_body': `
            <h3>Dominio del Cuerpo</h3>
            <p>Para controlar fuerzas externas, primero debe controlar su propio veh√≠culo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>Si√©ntese en una posici√≥n c√≥moda pero firme.</li>
                <li>Permanezca absolutamente inm√≥vil. No mueva ni un dedo, no parpadee excesivamente, no se rasque.</li>
                <li>Ignore cualquier picaz√≥n.</li>
                <li>Comience con 5 minutos y aumente gradualmente hasta lograr <b>30 minutos</b> de inmovilidad perfecta sin tensi√≥n.</li>
            </ul>
        `,

        // --- GRADO III ---
        'g3_mental': `
            <h3>Concentraci√≥n Multisensorial y Proyecci√≥n</h3>
            <p><b>Multisensorial:</b> Combine dos o m√°s sentidos en la imaginaci√≥n. Vea un reloj, escuche su tic-tac y sienta su forma fr√≠a y met√°lica simult√°neamente.</p>
            <p><b>Proyecci√≥n Externa:</b></p>
            <ol>
                <li>Visualice un objeto con los ojos cerrados.</li>
                <li>Luego, abra los ojos y proyecte esa imagen fuera de su cabeza, haci√©ndola flotar en el aire ante usted.</li>
                <li>La imagen debe parecer tan real y tangible como un objeto f√≠sico.</li>
                <li>Desvanezca la imagen a voluntad.</li>
            </ol>
        `,
        'g3_astral': `
            <h3>Inhalaci√≥n de los Elementos</h3>
            <p>Aprender a cargar el cuerpo astral con los elementos universales. Use la respiraci√≥n por los poros.</p>
            <ul>
                <li>üî• <b>Fuego:</b> Inhale calor y expansi√≥n (seco). Sienta el calor f√≠sico.</li>
                <li>üí® <b>Aire:</b> Inhale ligereza y flotabilidad. Sienta que pierde peso.</li>
                <li>üíß <b>Agua:</b> Inhale fr√≠o y contracci√≥n (magn√©tico). Sienta fr√≠o glacial.</li>
                <li>üåç <b>Tierra:</b> Inhale peso y gravedad. Sienta pesadez de plomo.</li>
            </ul>
            <div class="warning-box"><b>¬°ADVERTENCIA!</b> Al terminar el ejercicio, siempre debe EXHALAR el elemento completamente hasta volver a la normalidad. No se quede cargado con un elemento o da√±ar√° su salud.</div>
        `,
        'g3_physical': `
            <h3>Acumulaci√≥n de Energ√≠a Vital</h3>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Respire por los poros inhalando energ√≠a vital del universo.</li>
                <li>No exhale la energ√≠a. Ret√©ngala en el cuerpo. Exhale solo el aire vac√≠o.</li>
                <li>Con cada respiraci√≥n, la energ√≠a se condensa m√°s. Sienta la presi√≥n, como vapor en una caldera.</li>
                <li>Cuando est√© lleno a reventar, proyecte esa energ√≠a a trav√©s de sus manos para curar, o devu√©lvala al universo explosivamente.</li>
            </ol>
        `,

        // --- GRADO IV ---
        'g4_mental': `
            <h3>Transferencia de Conciencia</h3>
            <p>Romper la barrera del "Yo".</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Si√©ntese frente a un objeto (ej. una piedra).</li>
                <li>Transfiera su conciencia al centro del objeto. Olvide su cuerpo.</li>
                <li>Sienta c√≥mo es "ser" la piedra (fr√≠a, dura, inm√≥vil).</li>
                <li>Progrese hacia plantas (sienta el crecimiento), luego animales (sienta el instinto) y finalmente seres humanos.</li>
            </ol>
        `,
        'g4_astral': `
            <h3>Acumulaci√≥n Elemental (Cuerpo)</h3>
            <p>Cargar regiones espec√≠ficas del cuerpo con elementos (Anatom√≠a Oculta). Esto equilibra el cuerpo astral.</p>
            <ul>
                <li><b>Fuego:</b> Cabeza (Voluntad).</li>
                <li><b>Aire:</b> Pecho (Sentimiento/Vida).</li>
                <li><b>Agua:</b> Abdomen (Emoci√≥n/Magnetismo).</li>
                <li><b>Tierra:</b> Piernas y Huesos (Conciencia f√≠sica).</li>
            </ul>
        `,
        'g4_physical': `
            <h3>Creaci√≥n de Rituales</h3>
            <p>El mago no depende de rituales ajenos, crea los suyos.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>Elija una intenci√≥n (ej. entrar en trance, protecci√≥n).</li>
                <li>Invente un gesto (mudra) con las manos o dedos que represente esa intenci√≥n.</li>
                <li>Cargue ese gesto con la voluntad repetidamente.</li>
                <li>Con el tiempo, solo hacer el gesto liberar√° la energ√≠a autom√°ticamente (como un gatillo).</li>
            </ul>
        `,

        // --- GRADO V ---
        'g5_mental': `
            <h3>Magia del Espacio (Profundidad del Punto)</h3>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Cierre los ojos. Imag√≠nese en el centro del universo infinito.</li>
                <li>Usted es solo un punto de conciencia. No tiene cuerpo.</li>
                <li>No hay arriba, abajo, ni lados. Solo profundidad infinita.</li>
                <li>Este es el contacto con el principio Akasha (la quintaesencia).</li>
            </ol>
        `,
        'g5_astral': `
            <h3>Proyecci√≥n Exterior de Elementos</h3>
            <p>Aprender a condensar elementos fuera del cuerpo.</p>
            <p><b>Instrucci√≥n:</b></p>
            <ul>
                <li>En lugar de inhalar el elemento hacia adentro, imag√≠nese que extrae el elemento del universo y llena la habitaci√≥n con √©l.</li>
                <li>Haga que la habitaci√≥n se sienta f√≠sicamente caliente (Fuego) o fr√≠a (Agua).</li>
                <li>Sienta que nada en el oc√©ano de ese elemento.</li>
                <li>Al final, disuelva el elemento de nuevo en el universo.</li>
            </ul>
        `,
        'g5_physical': `
            <h3>Comunicaci√≥n Pasiva</h3>
            <p>Preparaci√≥n para contactar con su √Ångel Guardi√°n o inteligencia superior.</p>
            <p><b>Pr√°ctica:</b></p>
            <ul>
                <li><b>Levitaci√≥n de la Mano:</b> Si√©ntese y ponga la mano en la mesa. Des√©e que su mano se mueva autom√°ticamente por la fuerza de su esp√≠ritu. No use m√∫sculos.</li>
                <li><b>P√©ndulo:</b> Use un p√©ndulo para obtener respuestas S√≠/No de su subconsciente.</li>
            </ul>
        `,

        // --- GRADO VI ---
        'g6_mental': `
            <h3>Meditaci√≥n en el Esp√≠ritu</h3>
            <p>Tome conciencia de su propio esp√≠ritu mental dentro del cuerpo. Diferencie claramente entre:</p>
            <ul>
                <li><b>Cuerpo F√≠sico:</b> El veh√≠culo.</li>
                <li><b>Cuerpo Astral (Alma):</b> El asiento de las emociones y car√°cter.</li>
                <li><b>Esp√≠ritu (Mental):</b> El "Yo" inmortal, la chispa divina.</li>
            </ul>
            <p>Aprenda a actuar plenamente como Esp√≠ritu.</p>
        `,
        'g6_astral': `
            <h3>Trance de Akasha</h3>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Entre en el estado de profundidad del punto (Grado 5).</li>
                <li>Medite en el Akasha: el mundo de las causas, sin tiempo ni espacio. El color es violeta oscuro o negro brillante.</li>
                <li>Absorba el Akasha en su conciencia.</li>
                <li>En este estado, usted est√° por encima de los elementos y del destino.</li>
            </ol>
        `,
        'g6_physical': `
            <h3>Creaci√≥n de Elementales</h3>
            <p>El acto de creaci√≥n m√°gica. Formar un servidor de energ√≠a.</p>
            <p><b>Pasos:</b></p>
            <ol>
                <li><b>Forma:</b> Imagine la forma del ser (ej. una bola de luz).</li>
                <li><b>Nombre:</b> Dele un nombre √∫nico.</li>
                <li><b>Tarea:</b> Ordene una tarea espec√≠fica y √©tica.</li>
                <li><b>Tiempo:</b> Fije su duraci√≥n de vida.</li>
                <li><b>Proyecci√≥n:</b> Separe una parte de su propia energ√≠a vital o elemental y llene la forma.</li>
                <li><b>Reabsorci√≥n:</b> Al terminar la tarea o el tiempo, reabsorba la energ√≠a y disuelva la forma.</li>
            </ol>
        `,

        // --- GRADO VII ---
        'g7_mental': `
            <h3>An√°lisis del Esp√≠ritu</h3>
            <p>Similar al Espejo del Alma del Grado 1, pero enfocado en las capacidades mentales: Voluntad, Intelecto y Sentimiento. Aseg√∫rese de que est√©n equilibradas. Un mago inteligente pero sin voluntad es d√©bil; uno con voluntad pero tonto es peligroso.</p>
        `,
        'g7_astral': `
            <h3>Desarrollo de los Sentidos Astrales</h3>
            <p><b>Clarividencia (Ojo M√°gico):</b> Crear un "Ojo" de luz condensada y proyectarlo para ver a distancia o ver auras.</p>
            <p><b>Clariaudiencia:</b> Escuchar voces espirituales. Se practica concentr√°ndose en la regi√≥n del o√≠do con el elemento Aire.</p>
            <p><b>Clarinsentencia:</b> Sentir vibraciones a trav√©s del plexo solar (Elemento Agua/Tierra).</p>
        `,
        'g7_physical': `
            <h3>Creaci√≥n de Elementarios</h3>
            <p>Diferencia con Elementales: Los elementales se forman con la energ√≠a del mago. Los <b>Elementarios</b> se forman tomando energ√≠a prestada de la naturaleza o del universo, haci√©ndolos m√°s independientes y poderosos.</p>
            <div class="warning-box">Solo para iniciados con √©tica impecable. El abuso crea karma negativo severo.</div>
        `,

        // --- GRADO VIII ---
        'g8_mental': `
            <h3>Viaje Mental (Wandering)</h3>
            <p>La t√©cnica de salir del cuerpo f√≠sico NO con el cuerpo astral, sino con el <b>Cuerpo Mental</b> (Esp√≠ritu).</p>
            <p><b>Instrucci√≥n:</b></p>
            <ol>
                <li>Transfiera su conciencia fuera del cuerpo (como en Grado 4).</li>
                <li>Visual√≠cese de pie junto a su cuerpo f√≠sico.</li>
                <li>Intente observar la habitaci√≥n. Al principio ser√° imaginaci√≥n, luego visi√≥n real.</li>
                <li>Viaje a lugares cercanos, luego lejanos.</li>
                <li>No hay cord√≥n de plata en el viaje mental, por lo que es m√°s seguro que el astral.</li>
            </ol>
        `,
        'g8_astral': `
            <h3>Fluidos El√©ctrico y Magn√©tico</h3>
            <p>El Gran Arcano. Dominio de los dos fluidos primordiales del universo.</p>
            <ul>
                <li><b>Fluido El√©ctrico (Fuego/Aire):</b> Origen de la luz, el calor y la expansi√≥n. Color Rojo. Se proyecta desde el centro hacia afuera.</li>
                <li><b>Fluido Magn√©tico (Agua/Tierra):</b> Origen del peso, fr√≠o y contracci√≥n. Color Azul. Se proyecta de afuera hacia adentro.</li>
            </ul>
        `,
        'g8_physical': `
            <h3>Condensadores Flu√≠dicos</h3>
            <p>Creaci√≥n de sustancias alqu√≠micas capaces de retener cargas m√°gicas enormes.</p>
            <p><b>Condensador Simple:</b> Infusi√≥n muy fuerte de manzanilla.</p>
            <p><b>Condensador Compuesto:</b> Mezclas complejas de hierbas, metales (tintura de oro) y a veces fluidos corporales (sangre/esperma - solo para uso personal). Se usan para pintar espejos m√°gicos, cargar varas o consumir en dosis homeop√°ticas.</p>
        `,

        // --- GRADO IX ---
        'g9_mental': `
            <h3>Visi√≥n en el Espejo M√°gico</h3>
            <p>Uso avanzado del espejo (construido y cargado previamente).</p>
            <ul>
                <li><b>Visi√≥n a trav√©s del Espacio:</b> Ver lugares remotos.</li>
                <li><b>Visi√≥n a trav√©s del Tiempo:</b> Ver el pasado (Akasha) o probabilidades futuras.</li>
                <li><b>Influencia:</b> Enviar energ√≠a o elementales a trav√©s del espejo a una persona distante.</li>
            </ul>
        `,
        'g9_astral': `
            <h3>Viaje Astral</h3>
            <p>La separaci√≥n completa del cuerpo Astral (Alma) del f√≠sico.</p>
            <ul>
                <li>A diferencia del viaje mental, aqu√≠ se lleva la "matriz astral".</li>
                <li>Usted est√° conectado al f√≠sico por el <b>Cord√≥n de Plata</b>. Si se rompe, ocurre la muerte f√≠sica.</li>
                <li>Permite acci√≥n f√≠sica a distancia y contacto tangible con entidades.</li>
                <li>Peligroso si no se tiene equilibrio m√°gico.</li>
            </ul>
        `,
        'g9_physical': `
            <h3>Tratamiento con Fluido Electromagn√©tico (Volts)</h3>
            <p>Creaci√≥n de "Volts" (esferas de energ√≠a concentrada) para alterar el destino, proteger o curar enfermedades graves. Carga de Talismanes permanentes usando los fluidos universales.</p>
        `,

        // --- GRADO X ---
        'g10_mental': `
            <h3>Ascensi√≥n a los Planos (Esferas)</h3>
            <p>El mago eleva su esp√≠ritu a las esferas planetarias (√Årbol de la Vida).</p>
            <ul>
                <li>Esfera de la Luna.</li>
                <li>Esfera de Mercurio.</li>
                <li>Esfera de Venus.</li>
                <li>Esfera del Sol, etc.</li>
            </ul>
            <p>Contactar con las inteligencias de cada esfera y aprender sus secretos.</p>
        `,
        'g10_astral': `
            <h3>Comuni√≥n con la Deidad</h3>
            <p>El paso final. Unificaci√≥n con el Dios personal.</p>
            <p>Meditaci√≥n profunda en las 4 virtudes divinas hasta convertirse en ellas:</p>
            <ol>
                <li><b>Omnipotencia (Fuego).</b></li>
                <li><b>Sabidur√≠a/Omnisciencia (Aire).</b></li>
                <li><b>Amor/Misericordia (Agua).</b></li>
                <li><b>Inmortalidad/Inmutabilidad (Tierra).</b></li>
            </ol>
        `,
        'g10_physical': `
            <h3>Poderes Externos y C√°bala</h3>
            <p>El Adepto. Uso de la palabra m√°gica (C√°bala) para alterar la realidad f√≠sica instant√°neamente. Facultades como la teletransportaci√≥n, invisibilidad f√≠sica y materializaci√≥n.</p>
        `,

        // --- HERRAMIENTAS ---
        'tool_mirror': `<h3>El Espejo M√°gico</h3><p><b>Material:</b> Vidrio c√≥ncavo (como de reloj antiguo) o superficie plana negra brillante.<br><b>Construcci√≥n:</b> Limpie el vidrio perfectamente. Aplique varias capas de laca negra brillante o nitrato de plata en el lado convexo (trasero). Puede a√±adir gotas de condensador flu√≠dico en la pintura.<br><b>Uso:</b> C√°rgalo con Akasha o Luz imaginaria. No mires tu reflejo f√≠sico (desenfoca la vista), mira "a trav√©s" de la superficie hacia el infinito negro. Sirve para desarrollar la visi√≥n astral y contactar inteligencias.</p>`,
        'tool_wand': `<h3>La Vara M√°gica</h3><p>Simboliza la Voluntad Absoluta y el Elemento Fuego/Aire.<br><b>Simple:</b> Rama de avellano cortada con cuchillo virgen al amanecer. Limpia y magnetizada.<br><b>Compleja (Modelo Bardon):</b> Tubo de acero con un hilo de cobre en el centro, aislado, con condensador s√≥lido o l√≠quido dentro. Polarizada (+/-).<br><b>Uso:</b> Para proyectar fuerza concentrada, trazar c√≠rculos de protecci√≥n y mandar a seres elementales.</p>`,
        'tool_lamp': `<h3>La L√°mpara M√°gica</h3><p>Una l√°mpara de aceite o el√©ctrica simple.<br><b>Uso:</b> Se cubre con papel celof√°n o vidrio de colores para generar atm√≥sferas espec√≠ficas en la habitaci√≥n ritual.<br>Rojo = Fuego / Voluntad.<br>Azul = Aire / Inteligencia.<br>Verde = Agua / Sentimiento.<br>Amarillo = Tierra / Conciencia.<br>Violeta = Akasha / Misterio.</p>`,
        'tool_fluid': `<h3>Condensadores Flu√≠dicos</h3><p>Sustancias capaces de retener y amplificar cargas m√°gicas.<br><b>Simple:</b> Infusi√≥n muy fuerte de manzanilla o t√© negro.<br><b>Compuesto Universal:</b> Mezcla de extractos alcoh√≥licos de: Ang√©lica, Salvia, Tilo, Pepino, Acacia, Manzanilla, Azucena, Canela, Ortiga, Menta, √Ålamo, Violeta, Sauce, Tabaco + Tintura de Oro.<br><b>Uso:</b> Pintar espejos, cargar varas o consumo personal (diluido homeop√°ticamente).</p>`,
        'tool_pentacle': `<h3>El Pent√°culo</h3><p>Disco de cera virgen, madera o metal que simboliza el cuerpo y el elemento Tierra.<br><b>Uso:</b> Se graba con s√≠mbolos pertinentes a la operaci√≥n. Se usa para protecci√≥n, para evocar energ√≠as terrestres y como "tierra" para descargar energ√≠as sobrantes.</p>`
    };

    // --- 2. CONFIGURACI√ìN DE GRADOS Y REPETICIONES ---
    const gradesData = [
        {
            id: 'g1', 
            title: 'Grado I: El Iniciado', 
            sub: 'Dominio de Pensamientos y Elementos B√°sicos',
            tasks: [
                {id: 't1_1', text: 'Mental: Control del Pensamiento (Observador)', target: 14, ref: 'g1_m_obs'},
                {id: 't1_2', text: 'Mental: Disciplina (Un solo pensamiento)', target: 14, ref: 'g1_m_disc'},
                {id: 't1_3', text: 'Mental: Vac√≠o Mental', target: 21, ref: 'g1_m_vaci'},
                {id: 't1_4', text: 'Astral: El Espejo del Alma', target: 14, ref: 'g1_a_magic'},
                {id: 't1_5', text: 'F√≠sico: Higiene Energ√©tica', target: 30, ref: 'g1_p_skin'},
                {id: 't1_6', text: 'F√≠sico: Respiraci√≥n Consciente', target: 30, ref: 'g1_p_breath'},
                {id: 't1_7', text: 'F√≠sico: Magia del Agua y Comida', target: 30, ref: 'g1_p_euc'}
            ]
        },
        {
            id: 'g2', 
            title: 'Grado II: Concentraci√≥n', 
            sub: 'Autosugesti√≥n y Refinamiento',
            tasks: [
                {id: 't2_1', text: 'Mental: Autosugesti√≥n', target: 21, ref: 'g2_mental'},
                {id: 't2_2', text: 'Mental: Concentraci√≥n Sensorial', target: 14, ref: 'g2_sensory'},
                {id: 't2_3', text: 'Astral: Transformaci√≥n del Car√°cter', target: 21, ref: 'g2_astral'},
                {id: 't2_4', text: 'F√≠sico: Respiraci√≥n por los Poros', target: 14, ref: 'g2_physical'},
                {id: 't2_5', text: 'F√≠sico: Dominio del Cuerpo', target: 14, ref: 'g2_body'}
            ]
        },
        {
            id: 'g3', 
            title: 'Grado III: Los Elementos', 
            sub: 'Respiraci√≥n Elemental y Proyecci√≥n',
            tasks: [
                {id: 't3_1', text: 'Mental: Visualizaci√≥n Multisensorial', target: 14, ref: 'g3_mental'},
                {id: 't3_2', text: 'Mental: Proyecci√≥n de Im√°genes', target: 14, ref: 'g3_mental'},
                {id: 't3_3', text: 'Astral: Inhalaci√≥n de Elementos', target: 21, ref: 'g3_astral'},
                {id: 't3_4', text: 'F√≠sico: Acumulaci√≥n Vital', target: 14, ref: 'g3_physical'}
            ]
        },
        {
            id: 'g4', 
            title: 'Grado IV: Rituales', 
            sub: 'Transferencia de Conciencia',
            tasks: [
                {id: 't4_1', text: 'Mental: Transferencia de Conciencia', target: 14, ref: 'g4_mental'},
                {id: 't4_2', text: 'Astral: Acumulaci√≥n Elemental (Cuerpo)', target: 20, ref: 'g4_astral'},
                {id: 't4_3', text: 'F√≠sico: Creaci√≥n de Rituales', target: 7, ref: 'g4_physical'}
            ]
        },
        {
            id: 'g5', 
            title: 'Grado V: Alquimia Espacial', 
            sub: 'Magia del Espacio y Comunicaci√≥n',
            tasks: [
                {id: 't5_1', text: 'Mental: Magia del Espacio', target: 14, ref: 'g5_mental'},
                {id: 't5_2', text: 'Astral: Proyecci√≥n Exterior', target: 20, ref: 'g5_astral'},
                {id: 't5_3', text: 'F√≠sico: Comunicaci√≥n Pasiva', target: 14, ref: 'g5_physical'}
            ]
        },
        {
            id: 'g6', 
            title: 'Grado VI: Akasha', 
            sub: 'Elementales y Meditaci√≥n Espiritual',
            tasks: [
                {id: 't6_1', text: 'Mental: Meditaci√≥n en el Esp√≠ritu', target: 14, ref: 'g6_mental'},
                {id: 't6_2', text: 'Astral: Trance de Akasha', target: 14, ref: 'g6_astral'},
                {id: 't6_3', text: 'F√≠sico: Creaci√≥n de Elementales', target: 7, ref: 'g6_physical'}
            ]
        },
        {
            id: 'g7', 
            title: 'Grado VII: Sentidos Astrales', 
            sub: 'Clarividencia y Elementarios',
            tasks: [
                {id: 't7_1', text: 'Mental: An√°lisis del Esp√≠ritu', target: 7, ref: 'g7_mental'},
                {id: 't7_2', text: 'Astral: Clarividencia', target: 21, ref: 'g7_astral'},
                {id: 't7_3', text: 'F√≠sico: Elementarios', target: 7, ref: 'g7_physical'}
            ]
        },
        {
            id: 'g8', 
            title: 'Grado VIII: Viaje Mental', 
            sub: 'Fluidos y Separaci√≥n',
            tasks: [
                {id: 't8_1', text: 'Mental: Viaje Mental', target: 21, ref: 'g8_mental'},
                {id: 't8_2', text: 'Astral: Control de Fluidos El√©c./Mag.', target: 21, ref: 'g8_astral'},
                {id: 't8_3', text: 'F√≠sico: Condensadores Flu√≠dicos', target: 7, ref: 'g8_physical'}
            ]
        },
        {
            id: 'g9', 
            title: 'Grado IX: Viaje Astral', 
            sub: 'Espejo M√°gico y Volts',
            tasks: [
                {id: 't9_1', text: 'Mental: Visi√≥n en el Espejo M√°gico', target: 14, ref: 'g9_mental'},
                {id: 't9_2', text: 'Astral: Viaje Astral', target: 21, ref: 'g9_astral'},
                {id: 't9_3', text: 'F√≠sico: Volts y Talismanes', target: 7, ref: 'g9_physical'}
            ]
        },
        {
            id: 'g10', 
            title: 'Grado X: El Adepto', 
            sub: 'Uni√≥n Divina y Esferas',
            tasks: [
                {id: 't10_1', text: 'Mental: Ascensi√≥n a los Planos', target: 30, ref: 'g10_mental'},
                {id: 't10_2', text: 'Astral: Comuni√≥n con la Deidad', target: 30, ref: 'g10_astral'},
                {id: 't10_3', text: 'F√≠sico: Poderes Externos', target: 14, ref: 'g10_physical'}
            ]
        }
    ];

    // --- 3. L√ìGICA DE LA APLICACI√ìN ---

    let userProgress = JSON.parse(localStorage.getItem('bardonMasterProgress')) || {};

    // Inicializar progreso si est√° vac√≠o
    if (Object.keys(userProgress).length === 0) {
        gradesData.forEach(g => {
            g.tasks.forEach(t => userProgress[t.id] = 0);
        });
        localStorage.setItem('bardonMasterProgress', JSON.stringify(userProgress));
    }

    function renderView(viewName) {
        // Actualizar botones nav
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        if(viewName === 'training') document.querySelectorAll('.nav-btn')[0].classList.add('active');
        if(viewName === 'tools') document.querySelectorAll('.nav-btn')[1].classList.add('active');
        if(viewName === 'library') document.querySelectorAll('.nav-btn')[2].classList.add('active');

        const container = document.getElementById('main-view');
        container.innerHTML = ''; 

        if (viewName === 'training') renderTraining(container);
        if (viewName === 'tools') renderTools(container);
        if (viewName === 'library') renderLibrary(container);
        
        window.scrollTo(0, 0);
    }

    function renderTraining(container) {
        let isPreviousGradeComplete = true;

        gradesData.forEach((grade) => {
            let currentGradeComplete = true;
            grade.tasks.forEach(t => {
                if (userProgress[t.id] < t.target) currentGradeComplete = false;
            });

            const isLocked = !isPreviousGradeComplete;
            const completedClass = currentGradeComplete ? 'completed' : '';
            const lockedClass = isLocked ? 'locked' : '';
            const icon = isLocked ? 'üîí' : (currentGradeComplete ? '‚úì' : '‚úß');

            const gradeHTML = document.createElement('div');
            gradeHTML.className = 'grade-wrapper';
            gradeHTML.innerHTML = `
                <div class="grade-header ${lockedClass} ${completedClass}" onclick="toggleGrade('list-${grade.id}', ${isLocked})">
                    <div>
                        <div class="grade-title">${grade.title}</div>
                        <div class="grade-info">${grade.sub}</div>
                    </div>
                    <div style="font-size:1.5rem; color:var(--accent-gold);">${icon}</div>
                </div>
                <div id="list-${grade.id}" class="exercises-list">
                    ${renderTasks(grade.tasks, isLocked)}
                </div>
            `;
            container.appendChild(gradeHTML);

            if (!currentGradeComplete) isPreviousGradeComplete = false;
        });
        
        if(isPreviousGradeComplete) {
             const congrats = document.createElement('div');
             congrats.innerHTML = `<div style="text-align:center; padding:20px; color:var(--accent-gold); border:1px solid var(--accent-gold); margin-top:20px; border-radius:10px;"><h3>¬°MAESTR√çA ALCANZADA!</h3><p>Has completado el camino de la Iniciaci√≥n.</p></div>`;
             container.appendChild(congrats);
        }
    }

    function renderTasks(tasks, isLocked) {
        if (isLocked) return `<div style="padding:15px; color:#666; font-style:italic;">Completa el grado anterior para desbloquear los misterios.</div>`;
        
        return tasks.map(t => {
            const currentReps = userProgress[t.id] || 0;
            const percentage = Math.min(100, Math.floor((currentReps / t.target) * 100));
            const isDone = currentReps >= t.target;
            const btnText = isDone ? 'Completado' : 'Registrar (+1)';
            const btnDisabled = isDone ? 'disabled' : '';
            
            let tagType = 'mental';
            let tagText = 'Mental';
            if(t.text.includes('Astral') || t.text.includes('Espejo') || t.text.includes('Inhalaci√≥n')) { tagType = 'astral'; tagText = 'Astral'; }
            if(t.text.includes('F√≠sico') || t.text.includes('Cuerpo') || t.text.includes('Higiene')) { tagType = 'fisico'; tagText = 'F√≠sico'; }

            return `
            <div class="exercise-card">
                <span class="ex-tag ${tagType}">${tagText}</span>
                <div class="ex-title">${t.text}</div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span>Progreso: ${currentReps}/${t.target}</span>
                        <span>${percentage}%</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" style="width:${percentage}%"></div>
                    </div>
                </div>
                <div class="actions">
                    <button class="btn btn-theory" onclick="showTheory('${t.ref}', '${t.text}')">
                        üìñ Teor√≠a
                    </button>
                    <button class="btn btn-train" onclick="addProgress('${t.id}', ${t.target})" ${btnDisabled}>
                        ‚ö° ${btnText}
                    </button>
                </div>
            </div>
            `;
        }).join('');
    }

    function renderTools(container) {
        container.innerHTML = `
            <h2 style="color:var(--accent-gold); text-align:center; font-family:'Cinzel', serif; margin-bottom:20px;">Instrumentarium M√°gico</h2>
            <div class="tool-grid">
                <div class="tool-item" onclick="showTheory('tool_mirror', 'El Espejo M√°gico')"><span class="tool-icon">üîÆ</span><div class="tool-text">Espejo M√°gico</div></div>
                <div class="tool-item" onclick="showTheory('tool_wand', 'La Vara M√°gica')"><span class="tool-icon">ü™Ñ</span><div class="tool-text">Vara de Poder</div></div>
                <div class="tool-item" onclick="showTheory('tool_fluid', 'Condensadores')"><span class="tool-icon">‚öóÔ∏è</span><div class="tool-text">Condensadores</div></div>
                <div class="tool-item" onclick="showTheory('tool_pentacle', 'El Pent√°culo')"><span class="tool-icon">‚õ§</span><div class="tool-text">Pent√°culo</div></div>
                 <div class="tool-item" onclick="showTheory('tool_lamp', 'La L√°mpara M√°gica')"><span class="tool-icon">üèÆ</span><div class="tool-text">L√°mpara</div></div>
            </div>

            <h3 style="color:var(--accent-teal-bright); margin-top:30px; text-align:center;">Los Tattwas (Elementos)</h3>
            <div style="background:var(--bg-card); padding:20px; border-radius:10px; margin-top:10px; text-align:center; border:1px solid rgba(255,255,255,0.05);">
                <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">S√≠mbolos visuales para la meditaci√≥n elemental.</p>
                <div class="tattwa-box">
                    <div class="tattwa-wrapper"><div class="tattwa-akasha"></div><small style="font-size:0.7em; color:#666">Akasha</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-fire"></div><small style="font-size:0.7em; color:#666">Tejas</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-air"></div><small style="font-size:0.7em; color:#666">Waju</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-water"></div><small style="font-size:0.7em; color:#666">Apas</small></div>
                    <div class="tattwa-wrapper"><div class="tattwa-earth"></div><small style="font-size:0.7em; color:#666">Prithivi</small></div>
                </div>
            </div>
        `;
    }

    function renderLibrary(container) {
        container.innerHTML = `
            <h2 style="color:var(--accent-gold); text-align:center; font-family:'Cinzel', serif; margin-bottom:20px;">Biblioteca Herm√©tica</h2>
            <div class="exercise-card"><div class="ex-title" style="color:var(--accent-gold);">Iniciaci√≥n al Hermetismo</div><p class="ex-desc">El curso base de 10 pasos. Trata sobre el equilibrio de los elementos y el dominio del yo.</p></div>
            <div class="exercise-card"><div class="ex-title" style="color:var(--accent-teal-bright);">La Pr√°ctica de la Evocaci√≥n M√°gica</div><p class="ex-desc">Gu√≠a para contactar inteligencias de las esferas planetarias. Requiere haber completado el Grado 8 de IIH.</p></div>
            <div class="exercise-card"><div class="ex-title" style="color:#b388ff;">La Clave de la Verdadera C√°bala</div><p class="ex-desc">El uso del Verbo y el Sonido. La magia de las letras.</p></div>
            <div style="text-align:center; margin-top:20px; font-size:0.8rem; color:#666;"><p>"El saber no es suficiente; debemos aplicar. El querer no es suficiente; debemos hacer."</p></div>
        `;
    }

    function toggleGrade(elementId, isLocked) {
        if (isLocked) { alert("Completa el grado anterior."); return; }
        document.getElementById(elementId).classList.toggle('open');
    }

    function addProgress(taskId, target) {
        if (userProgress[taskId] < target) {
            userProgress[taskId]++;
            localStorage.setItem('bardonMasterProgress', JSON.stringify(userProgress));
            renderView('training');
        }
    }

    function showTheory(key, title) {
        const modal = document.getElementById('appModal');
        const content = libraryData[key] || "<p>Informaci√≥n no disponible.</p>";
        document.getElementById('modal-body').innerHTML = `<h3>${title}</h3>${content}`;
        modal.style.display = "block";
    }

    function closeModal() { document.getElementById('appModal').style.display = "none"; }
    
    function resetProgressConfirm() {
        if(confirm("¬øEst√°s seguro de reiniciar todo el progreso?")) {
            localStorage.removeItem('bardonMasterProgress');
            location.reload();
        }
    }

    window.onclick = function(event) {
        const modal = document.getElementById('appModal');
        if (event.target == modal) modal.style.display = "none";
    }

    // Inicializar
    renderView('training');
</script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/Hemetic-work/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registrado con √©xito: ', registration.scope);
                })
                .catch(error => {
                    console.log('Fallo en el registro de ServiceWorker: ', error);
                });
        });
    }
</script>    
</body>
</html>
